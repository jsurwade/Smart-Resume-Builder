<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Resume Builder - Create Your Resume Your Way</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lato:wght@300;400;700&family=Roboto:wght@300;400;500;700&family=Playfair+Display:wght@400;600;700&family=Montserrat:wght@400;600;700&family=Orbitron:wght@400;600;700;900&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      overflow-x: hidden;
    }
    
    .font-inter { font-family: 'Inter', sans-serif; }
    .font-lato { font-family: 'Lato', sans-serif; }
    .font-roboto { font-family: 'Roboto', sans-serif; }
    .font-georgia { font-family: 'Georgia', serif; }
    .font-playfair { font-family: 'Playfair Display', serif; }
    .font-montserrat { font-family: 'Montserrat', sans-serif; }
    .font-orbitron { font-family: 'Orbitron', sans-serif; }
    .font-quicksand { font-family: 'Quicksand', sans-serif; }
    
    .a4-preview {
      width: 210mm;
      min-height: 297mm;
      background: white;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      margin: 0 auto;
    }
    
    @media print {
      .a4-preview {
        box-shadow: none;
        margin: 0;
      }
    }
    
    .gradient-hero {
      background: linear-gradient(135deg, #EFF6FF 0%, #E0E7FF 100%);
    }
    
    .animate-fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .skill-tag {
      display: inline-block;
      background: #e5e7eb;
      padding: 4px 12px;
      border-radius: 16px;
      margin: 4px;
      font-size: 14px;
    }
    
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }
    
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #10b981;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from { transform: translateX(400px); }
      to { transform: translateX(0); }
    }
    
    .builder-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      max-width: 1800px;
      margin: 0 auto;
      align-items: start;
    }
    
    .preview-sticky {
      position: sticky;
      top: 80px;
      max-height: calc(100vh - 100px);
      overflow-y: auto;
    }
    
    @media (max-width: 1024px) {
      .builder-grid {
        grid-template-columns: 1fr;
      }
      
      .preview-sticky {
        position: relative;
        top: 0;
        max-height: none;
      }
      
      .a4-preview {
        transform: scale(0.5);
        transform-origin: top center;
        margin-bottom: -500px;
      }
    }
    
    @media (max-width: 640px) {
      .a4-preview {
        transform: scale(0.4);
        margin-bottom: -600px;
      }
    }
    
    .skill-input-wrapper {
      position: relative;
    }
    
    .skill-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 10;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .skill-suggestion-item {
      padding: 8px 12px;
      cursor: pointer;
      transition: background 0.15s;
    }
    
    .skill-suggestion-item:hover {
      background: #f3f4f6;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    
    // Configure PDF.js worker
    if (typeof pdfjsLib !== 'undefined') {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }
    
    // PDF Text Extraction
    async function extractTextFromPDF(file) {
      return new Promise((resolve, reject) => {
        const fileReader = new FileReader();
        
        fileReader.onload = async function() {
          try {
            const typedArray = new Uint8Array(this.result);
            const pdf = await pdfjsLib.getDocument(typedArray).promise;
            
            let fullText = '';
            
            // Extract text from all pages
            for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
              const page = await pdf.getPage(pageNum);
              const textContent = await page.getTextContent();
              const pageText = textContent.items.map(item => item.str).join(' ');
              fullText += pageText + '\n';
            }
            
            resolve(fullText);
          } catch (error) {
            reject(error);
          }
        };
        
        fileReader.onerror = reject;
        fileReader.readAsArrayBuffer(file);
      });
    }
    
    // DOCX Text Extraction
    async function extractTextFromDOCX(file) {
      return new Promise((resolve, reject) => {
        const fileReader = new FileReader();
        
        fileReader.onload = async function(e) {
          try {
            const arrayBuffer = e.target.result;
            const result = await mammoth.extractRawText({ arrayBuffer });
            resolve(result.value);
          } catch (error) {
            reject(error);
          }
        };
        
        fileReader.onerror = reject;
        fileReader.readAsArrayBuffer(file);
      });
    }
    
    // Smart Resume Parser with Comprehensive Extraction including Custom Fields
    function parseResumeText(text) {
      console.log('=== PARSING RESUME ===');
      console.log('Raw text length:', text.length);
      console.log('First 200 chars:', text.substring(0, 200));
      
      const lines = text.split('\n').map(l => l.trim()).filter(l => l);
      
      const resumeData = {
        personalInfo: {
          fullName: '',
          jobTitle: '',
          email: '',
          phone: '',
          location: '',
          linkedin: '',
          website: '',
          github: '',
          twitter: '',
          photoUrl: ''
        },
        summary: '',
        experience: [],
        education: [],
        projects: [],
        skills: [],
        certifications: [],
        achievements: [],
        languages: [],
        interests: [],
        references: [],
        awards: [],
        publications: [],
        volunteering: [],
        customFields: []
      };
      
      // Extract email (regex)
      const emailRegex = /[\w.-]+@[\w.-]+\.\w+/g;
      const emails = text.match(emailRegex);
      if (emails && emails.length > 0) {
        resumeData.personalInfo.email = emails[0];
        console.log('Extracted email:', emails[0]);
      }
      
      // Extract phone (regex for various formats)
      const phoneRegex = /(\+\d{1,3}[-.\s]?)?\(?\d{3}\)?[-.\s]?\d{3}[-.\s]?\d{4}/g;
      const phones = text.match(phoneRegex);
      if (phones && phones.length > 0) {
        resumeData.personalInfo.phone = phones[0];
        console.log('Extracted phone:', phones[0]);
      }
      
      // Extract LinkedIn URL
      const linkedinRegex = /(linkedin\.com\/in\/[\w-]+)/gi;
      const linkedin = text.match(linkedinRegex);
      if (linkedin) {
        resumeData.personalInfo.linkedin = linkedin[0];
        console.log('Extracted LinkedIn:', linkedin[0]);
      }
      
      // Extract GitHub URL
      const githubRegex = /(github\.com\/[\w-]+)/gi;
      const github = text.match(githubRegex);
      if (github) {
        resumeData.personalInfo.github = github[0];
        console.log('Extracted GitHub:', github[0]);
      }
      
      // Extract Twitter/X handle
      const twitterRegex = /(twitter\.com\/[\w-]+|x\.com\/[\w-]+|@[\w-]+)/gi;
      const twitter = text.match(twitterRegex);
      if (twitter) {
        resumeData.personalInfo.twitter = twitter[0];
        console.log('Extracted Twitter:', twitter[0]);
      }
      
      // Extract website/portfolio
      const websiteRegex = /(https?:\/\/[\w.-]+\.[a-z]{2,}(?:\/[^\s]*)?)/gi;
      const websites = text.match(websiteRegex);
      if (websites) {
        // Filter out LinkedIn and GitHub URLs
        const portfolio = websites.find(url => 
          !url.toLowerCase().includes('linkedin') && 
          !url.toLowerCase().includes('github')
        );
        if (portfolio) {
          resumeData.personalInfo.website = portfolio;
          console.log('Extracted website:', portfolio);
        }
      }
      
      // Extract location (City, State or City, Country)
      const locationPattern1 = /([A-Z][a-z]+(?:\s[A-Z][a-z]+)*,\s*[A-Z]{2})\b/g;
      const locationPattern2 = /([A-Z][a-z]+(?:\s[A-Z][a-z]+)*,\s*[A-Z][a-z]+)/g;
      let location = text.match(locationPattern1);
      if (!location) location = text.match(locationPattern2);
      if (location && location.length > 0) {
        resumeData.personalInfo.location = location[0];
        console.log('Extracted location:', location[0]);
      }
      
      // Extract name - improved logic
      // Look at first 5 lines, exclude lines with @ or phone numbers or "resume"/"cv"
      for (let i = 0; i < Math.min(5, lines.length); i++) {
        const line = lines[i];
        if (line.length > 2 && line.length < 50 && 
            !line.includes('@') && 
            !line.match(/\d{3}/) && 
            !line.toLowerCase().includes('resume') && 
            !line.toLowerCase().includes('curriculum vitae') &&
            !line.toLowerCase().includes('cv')) {
          resumeData.personalInfo.fullName = line;
          console.log('Extracted name:', line);
          
          // Try to extract job title from next line
          if (i + 1 < lines.length) {
            const nextLine = lines[i + 1];
            if (!nextLine.includes('@') && 
                !nextLine.match(/\d{3}/) && 
                nextLine.length < 80 &&
                !nextLine.toLowerCase().includes('resume') &&
                !nextLine.toLowerCase().includes('cv')) {
              resumeData.personalInfo.jobTitle = nextLine;
              console.log('Extracted job title:', nextLine);
            }
          }
          break;
        }
      }
      
      // Find sections by common headers (case-insensitive) - COMPREHENSIVE LIST
      const sectionHeaders = {
        experience: ['experience', 'work experience', 'employment', 'work history', 'professional experience', 'employment history'],
        education: ['education', 'academic background', 'qualifications', 'academic', 'degrees'],
        skills: ['skills', 'technical skills', 'core competencies', 'expertise', 'core skills', 'technical expertise'],
        projects: ['projects', 'portfolio', 'key projects', 'personal projects'],
        summary: ['summary', 'professional summary', 'profile', 'objective', 'about', 'about me', 'career objective'],
        certifications: ['certifications', 'certificates', 'licenses', 'credentials', 'professional certifications'],
        languages: ['languages', 'language proficiency', 'language skills'],
        achievements: ['achievements', 'accomplishments', 'honors', 'recognition'],
        awards: ['awards', 'honors and awards', 'recognitions'],
        publications: ['publications', 'research', 'papers', 'published work'],
        volunteering: ['volunteer', 'volunteering', 'community', 'community service', 'social work', 'volunteer experience'],
        interests: ['interests', 'hobbies', 'personal interests', 'activities'],
        references: ['references', 'referees']
      };
      
      let currentSection = null;
      let sectionContent = [];
      const customSections = {}; // Track custom (unrecognized) sections
      
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const lowerLine = line.toLowerCase().trim();
        
        // Check if line is likely a section header
        const isLikelyHeader = (
          line.length < 60 && 
          line.length > 2 &&
          (
            line === line.toUpperCase() || 
            line.endsWith(':') || 
            (i < lines.length - 1 && lines[i + 1].match(/^[‚Ä¢\-\*]/)) ||
            (line.match(/^[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*$/)) // Title case
          )
        );
        
        // Check if line matches a known section header
        let foundSection = false;
        for (const [section, headers] of Object.entries(sectionHeaders)) {
          if (headers.some(h => lowerLine === h || lowerLine === h + ':' || lowerLine.startsWith(h + ' '))) {
            // Save previous section
            if (currentSection && sectionContent.length > 0) {
              if (currentSection.startsWith('custom_')) {
                customSections[currentSection] = sectionContent.slice();
              } else {
                processSectionContent(currentSection, sectionContent, resumeData);
              }
            }
            // Start new section
            currentSection = section;
            sectionContent = [];
            foundSection = true;
            break;
          }
        }
        
        // If not a known section but looks like a header, treat as custom section
        if (!foundSection && isLikelyHeader && !lowerLine.match(/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/)) {
          // Save previous section
          if (currentSection && sectionContent.length > 0) {
            if (currentSection.startsWith('custom_')) {
              customSections[currentSection] = sectionContent.slice();
            } else {
              processSectionContent(currentSection, sectionContent, resumeData);
            }
          }
          // Create custom section key
          const sectionKey = 'custom_' + line.replace(/[^a-zA-Z0-9]/g, '_').toLowerCase();
          currentSection = sectionKey;
          sectionContent = [];
          // Store the original title
          if (!customSections[sectionKey]) {
            customSections[sectionKey] = { title: line.replace(/:/g, '').trim(), content: [] };
          }
          foundSection = true;
        }
        
        if (!foundSection && currentSection) {
          sectionContent.push(line);
        }
      }
      
      // Process last section
      if (currentSection && sectionContent.length > 0) {
        if (currentSection.startsWith('custom_')) {
          customSections[currentSection] = sectionContent.slice();
        } else {
          processSectionContent(currentSection, sectionContent, resumeData);
        }
      }
      
      // Process custom sections into customFields array
      for (const [key, data] of Object.entries(customSections)) {
        let content, title;
        if (typeof data === 'object' && data.title) {
          title = data.title;
          content = data.content;
        } else {
          // data is array of content lines
          title = key.replace('custom_', '').replace(/_/g, ' ').split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
          content = data;
        }
        
        if (content.length > 0) {
          resumeData.customFields.push({
            id: key,
            title: title,
            content: content.join('\n'),
            type: 'text',
            isCustom: true,
            createdFromUpload: true
          });
        }
      }
      
      // Log final parsed data
      console.log('=== PARSING COMPLETE ===');
      console.log('Name:', resumeData.personalInfo.fullName);
      console.log('Email:', resumeData.personalInfo.email);
      console.log('Phone:', resumeData.personalInfo.phone);
      console.log('Experience count:', resumeData.experience.length);
      console.log('Education count:', resumeData.education.length);
      console.log('Skills count:', resumeData.skills.length);
      console.log('Projects count:', resumeData.projects.length);
      console.log('Certifications count:', resumeData.certifications.length);
      console.log('Languages count:', resumeData.languages.length);
      console.log('Awards count:', resumeData.awards.length);
      console.log('Publications count:', resumeData.publications.length);
      console.log('Volunteering count:', resumeData.volunteering.length);
      console.log('Custom fields count:', resumeData.customFields.length);
      if (resumeData.customFields.length > 0) {
        console.log('Custom sections detected:', resumeData.customFields.map(f => f.title).join(', '));
      }
      console.log('Full parsed data:', JSON.stringify(resumeData, null, 2));
      
      return resumeData;
    }
    
    function processSectionContent(section, content, resumeData) {
      const text = content.join('\n');
      
      switch(section) {
        case 'summary':
          resumeData.summary = text.trim();
          console.log('Extracted summary:', resumeData.summary.substring(0, 100) + '...');
          break;
          
        case 'skills':
          // Split by common delimiters
          const skillText = text.replace(/[‚Ä¢\-\*]/g, ',').trim();
          let skills = skillText.split(/[,\n|;]/g)
            .map(s => s.trim())
            .filter(s => s.length > 1 && s.length < 50)
            .filter(s => !s.toLowerCase().includes('skills'))
            .filter(s => !s.match(/^\d+$/)); // Remove pure numbers
          
          // Remove duplicates
          skills = [...new Set(skills)];
          resumeData.skills = skills;
          console.log('Extracted skills:', skills.length);
          break;
          
        case 'experience':
          // Parse experience entries (look for job titles, companies, dates)
          const experiences = parseExperience(content);
          resumeData.experience = experiences;
          break;
          
        case 'education':
          // Parse education entries
          const education = parseEducation(content);
          resumeData.education = education;
          break;
          
        case 'projects':
          // Parse project entries
          const projects = parseProjects(content);
          resumeData.projects = projects;
          break;
          
        case 'certifications':
          let certs = content.map(c => c.replace(/[‚Ä¢\-\*]/g, '').trim()).filter(c => c && c.length > 3);
          certs = [...new Set(certs)];
          resumeData.certifications = certs;
          console.log('Extracted certifications:', certs.length);
          break;
          
        case 'languages':
          let langs = content.map(l => l.replace(/[‚Ä¢\-\*]/g, '').trim()).filter(l => l && l.length > 1);
          langs = [...new Set(langs)];
          resumeData.languages = langs;
          console.log('Extracted languages:', langs.length);
          break;
          
        case 'achievements':
          let achievements = content.map(a => a.replace(/[‚Ä¢\-\*]/g, '').trim()).filter(a => a && a.length > 3);
          achievements = [...new Set(achievements)];
          resumeData.achievements = achievements;
          console.log('Extracted achievements:', achievements.length);
          break;
          
        case 'awards':
          let awards = content.map(a => a.replace(/[‚Ä¢\-\*]/g, '').trim()).filter(a => a && a.length > 3);
          awards = [...new Set(awards)];
          resumeData.awards = awards;
          console.log('Extracted awards:', awards.length);
          break;
          
        case 'publications':
          let pubs = content.map(p => p.replace(/[‚Ä¢\-\*]/g, '').trim()).filter(p => p && p.length > 3);
          pubs = [...new Set(pubs)];
          resumeData.publications = pubs;
          console.log('Extracted publications:', pubs.length);
          break;
          
        case 'volunteering':
          const volunteer = parseVolunteering(content);
          resumeData.volunteering = volunteer;
          break;
          
        case 'interests':
          let interests = content.map(i => i.replace(/[‚Ä¢\-\*]/g, '').trim()).filter(i => i && i.length > 1);
          interests = [...new Set(interests)];
          resumeData.interests = interests;
          console.log('Extracted interests:', interests.length);
          break;
          
        case 'references':
          let refs = content.map(r => r.replace(/[‚Ä¢\-\*]/g, '').trim()).filter(r => r && r.length > 3);
          refs = [...new Set(refs)];
          resumeData.references = refs;
          console.log('Extracted references:', refs.length);
          break;
      }
    }
    
    function parseVolunteering(lines) {
      const volunteering = [];
      let current = null;
      
      for (const line of lines) {
        if (line.length < 100 && !line.startsWith('‚Ä¢') && !line.startsWith('-')) {
          if (current) volunteering.push(current);
          current = {
            organization: line,
            role: '',
            description: ''
          };
        } else if (current) {
          current.description += (current.description ? '\n' : '') + line.replace(/[‚Ä¢\-\*]/g, '').trim();
        }
      }
      
      if (current) volunteering.push(current);
      console.log('Parsed volunteering entries:', volunteering.length);
      return volunteering;
    }
    
    function parseExperience(lines) {
      const experiences = [];
      let current = null;
      let descriptionLines = [];
      
      // Enhanced date pattern to catch more formats
      const datePattern = /(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec|January|February|March|April|May|June|July|August|September|October|November|December)\.?\s+\d{4}\s*[-‚Äì‚Äîto]+\s*(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec|January|February|March|April|May|June|July|August|September|October|November|December)\.?\s+\d{4}|Present|Current|\d{1,2}\/\d{4}\s*[-‚Äì‚Äîto]+\s*\d{1,2}\/\d{4}|\d{4}\s*[-‚Äì‚Äîto]+\s*\d{4}|\d{4}\s*[-‚Äì‚Äîto]+\s*(Present|Current|Now)/i;
      
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        const hasDate = datePattern.test(line);
        
        if (hasDate) {
          // Save previous experience
          if (current) {
            current.description = descriptionLines.join('\n').trim();
            if (current.jobTitle || current.company) {
              experiences.push(current);
            }
          }
          
          // Start new experience
          current = {
            jobTitle: '',
            company: '',
            location: '',
            startDate: '',
            endDate: '',
            description: ''
          };
          descriptionLines = [];
          
          // Extract dates with better parsing
          const dateMatch = line.match(datePattern);
          if (dateMatch) {
            const fullMatch = dateMatch[0];
            // Try to split by various delimiters
            const dates = fullMatch.split(/[-‚Äì‚Äî]|\s+to\s+/i);
            if (dates.length >= 2) {
              current.startDate = dates[0].trim();
              current.endDate = dates[1].trim();
            } else {
              current.startDate = fullMatch.trim();
              current.endDate = 'Present';
            }
          }
          
          // Job title might be on same line before date or previous line
          const beforeDate = line.substring(0, line.indexOf(dateMatch[0])).trim();
          if (beforeDate && beforeDate.length > 2) {
            current.jobTitle = beforeDate;
          } else if (i > 0 && lines[i - 1].length < 100) {
            current.jobTitle = lines[i - 1].trim();
          }
          
          // Company might be on next line
          if (i < lines.length - 1) {
            const nextLine = lines[i + 1].trim();
            if (!nextLine.match(/^[‚Ä¢\-\*]/) && nextLine.length < 100 && nextLine.length > 2) {
              current.company = nextLine;
            }
          }
          
        } else if (current && (line.match(/^[‚Ä¢\-\*]/) || line.length > 20)) {
          // This is a description line (bullet point or paragraph)
          descriptionLines.push(line.replace(/^[‚Ä¢\-\*]\s*/, ''));
        } else if (current && !current.company && line.length < 100 && line.length > 2) {
          // Might be company name if we haven't found it yet
          current.company = line.trim();
        }
      }
      
      // Don't forget last experience
      if (current) {
        current.description = descriptionLines.join('\n').trim();
        if (current.jobTitle || current.company) {
          experiences.push(current);
        }
      }
      
      console.log('Parsed experiences:', experiences.length);
      return experiences;
    }
    
    function parseEducation(lines) {
      const education = [];
      let current = null;
      
      const degreeKeywords = ['bachelor', 'master', 'phd', 'doctorate', 'mba', 'b.s.', 'm.s.', 'b.a.', 'm.a.', 'b.sc', 'm.sc', 'b.tech', 'm.tech', 'b.e.', 'm.e.', 'degree', 'diploma', 'associate', 'certificate', 'bsc', 'msc'];
      const yearPattern = /\b(19|20)\d{2}\b|\d{4}\s*[-‚Äì‚Äî]\s*\d{4}/;
      
      for (const line of lines) {
        const hasDegree = degreeKeywords.some(kw => line.toLowerCase().includes(kw));
        const hasYear = yearPattern.test(line);
        const hasInstitution = line.toLowerCase().includes('university') || 
                               line.toLowerCase().includes('college') || 
                               line.toLowerCase().includes('institute') || 
                               line.toLowerCase().includes('school');
        
        if (hasDegree || hasYear || hasInstitution) {
          if (current && (current.degree || current.institution)) {
            education.push(current);
          }
          
          current = {
            degree: '',
            institution: '',
            year: '',
            description: ''
          };
          
          // Extract year
          const yearMatch = line.match(yearPattern);
          if (yearMatch) {
            current.year = yearMatch[0];
          }
          
          // Determine what this line contains
          if (hasDegree) {
            current.degree = line.replace(yearPattern, '').trim();
          } else if (hasInstitution) {
            current.institution = line.replace(yearPattern, '').trim();
          }
        } else if (current) {
          // Additional info
          if (!current.institution && line.length > 5) {
            current.institution = line;
          } else if (!current.degree && line.length > 5) {
            current.degree = line;
          } else if (line.length > 0) {
            current.description += (current.description ? '\n' : '') + line;
          }
        }
      }
      
      if (current && (current.degree || current.institution)) {
        education.push(current);
      }
      
      console.log('Parsed education entries:', education.length);
      return education;
    }
    
    function parseProjects(lines) {
      const projects = [];
      let current = null;
      
      for (const line of lines) {
        // New project typically starts with a bold/title line
        if (line.length < 80 && !line.startsWith('‚Ä¢') && !line.startsWith('-')) {
          if (current) projects.push(current);
          current = {
            title: line,
            role: '',
            description: '',
            technologies: '',
            link: ''
          };
        } else if (current) {
          current.description += (current.description ? '\n' : '') + line;
        }
      }
      
      if (current) projects.push(current);
      return projects;
    }
    
    // Common skills suggestions
    const commonSkills = [
      'JavaScript', 'Python', 'Java', 'C++', 'React', 'Node.js', 'TypeScript', 'HTML', 'CSS',
      'SQL', 'MongoDB', 'PostgreSQL', 'Git', 'Docker', 'Kubernetes', 'AWS', 'Azure', 'GCP',
      'Machine Learning', 'Data Analysis', 'Project Management', 'Agile', 'Scrum',
      'Communication', 'Leadership', 'Problem Solving', 'Teamwork', 'Critical Thinking',
      'Vue.js', 'Angular', 'Django', 'Flask', 'Spring Boot', 'Express.js', 'REST API',
      'GraphQL', 'Redis', 'Elasticsearch', 'Jenkins', 'CI/CD', 'Linux', 'Bash',
      'TensorFlow', 'PyTorch', 'Pandas', 'NumPy', 'Matplotlib', 'Tableau', 'Power BI'
    ];
    
    // Skills Input Component with Suggestions
    const SkillsInput = ({ skills, onAddSkill, onRemoveSkill }) => {
      const [inputValue, setInputValue] = useState('');
      const [showSuggestions, setShowSuggestions] = useState(false);
      const [filteredSuggestions, setFilteredSuggestions] = useState([]);
      
      useEffect(() => {
        if (inputValue.length > 0) {
          const filtered = commonSkills.filter(skill => 
            skill.toLowerCase().includes(inputValue.toLowerCase()) &&
            !skills.includes(skill)
          ).slice(0, 10);
          setFilteredSuggestions(filtered);
          setShowSuggestions(filtered.length > 0);
        } else {
          setShowSuggestions(false);
        }
      }, [inputValue, skills]);
      
      const handleAdd = (skill) => {
        if (skill && !skills.includes(skill)) {
          onAddSkill(skill);
          setInputValue('');
          setShowSuggestions(false);
        }
      };
      
      return (
        <div className="space-y-3">
          <div className="skill-input-wrapper">
            <div className="flex gap-2">
              <input
                type="text"
                value={inputValue}
                onChange={(e) => setInputValue(e.target.value)}
                onKeyPress={(e) => {
                  if (e.key === 'Enter') {
                    e.preventDefault();
                    handleAdd(inputValue.trim());
                  }
                }}
                onFocus={() => inputValue && setShowSuggestions(true)}
                onBlur={() => setTimeout(() => setShowSuggestions(false), 200)}
                className="flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                placeholder="Type a skill and press Enter"
              />
              <button
                onClick={() => handleAdd(inputValue.trim())}
                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
              >
                Add
              </button>
            </div>
            {showSuggestions && filteredSuggestions.length > 0 && (
              <div className="skill-suggestions">
                {filteredSuggestions.map((suggestion, idx) => (
                  <div
                    key={idx}
                    className="skill-suggestion-item text-sm"
                    onClick={() => handleAdd(suggestion)}
                  >
                    {suggestion}
                  </div>
                ))}
              </div>
            )}
          </div>
          <div className="flex flex-wrap gap-2">
            {skills.map((skill, index) => (
              <span key={index} className="inline-flex items-center gap-2 bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm">
                {skill}
                <button
                  onClick={() => onRemoveSkill(index)}
                  className="hover:text-red-600 font-bold"
                >
                  ‚úï
                </button>
              </span>
            ))}
          </div>
          {skills.length === 0 && (
            <p className="text-gray-500 text-center py-4 text-sm">üí° Start typing to see suggestions or add your own skills</p>
          )}
        </div>
      );
    };
    
    // Default state structure
    const defaultState = {
      personalInfo: {
        fullName: "",
        jobTitle: "",
        email: "",
        phone: "",
        location: "",
        linkedin: "",
        website: "",
        github: "",
        twitter: "",
        photoUrl: ""
      },
      summary: "",
      experience: [],
      education: [],
      projects: [],
      skills: [],
      certifications: [],
      achievements: [],
      languages: [],
      interests: [],
      references: [],
      awards: [],
      publications: [],
      volunteering: [],
      customFields: [],
      template: "Minimalist",
      themeColors: {
        accent: "#2563eb",
        background: "#ffffff",
        text: "#111827"
      },
      font: "Inter"
    };
    
    // Sample data for demo
    const sampleData = {
      personalInfo: {
        fullName: "Jane Doe",
        jobTitle: "Full Stack Developer",
        email: "jane.doe@email.com",
        phone: "+1 (555) 123-4567",
        location: "San Francisco, CA",
        linkedin: "linkedin.com/in/janedoe",
        website: "janedoe.dev",
        github: "github.com/janedoe",
        photoUrl: ""
      },
      summary: "Passionate full-stack developer with 5+ years of experience building scalable web applications. Expertise in React, Node.js, and cloud technologies.",
      experience: [
        {
          jobTitle: "Senior Full Stack Developer",
          company: "Tech Innovations Inc",
          location: "San Francisco, CA",
          startDate: "2021-06",
          endDate: "Present",
          description: "‚Ä¢ Led development of microservices architecture serving 1M+ users\n‚Ä¢ Implemented CI/CD pipelines reducing deployment time by 60%\n‚Ä¢ Mentored team of 5 junior developers"
        },
        {
          jobTitle: "Software Engineer",
          company: "StartupXYZ",
          location: "Remote",
          startDate: "2019-01",
          endDate: "2021-05",
          description: "‚Ä¢ Built RESTful APIs using Node.js and Express\n‚Ä¢ Developed responsive React applications\n‚Ä¢ Optimized database queries improving performance by 40%"
        }
      ],
      education: [
        {
          degree: "Bachelor of Science in Computer Science",
          institution: "University of California",
          year: "2018",
          description: "GPA: 3.8/4.0, Dean's List"
        }
      ],
      projects: [
        {
          title: "E-Commerce Platform",
          role: "Lead Developer",
          description: "Built a full-featured e-commerce platform with payment integration, inventory management, and admin dashboard",
          technologies: "React, Node.js, MongoDB, Stripe",
          link: "github.com/janedoe/ecommerce"
        }
      ],
      skills: ["JavaScript", "React", "Node.js", "Python", "MongoDB", "PostgreSQL", "AWS", "Docker", "Git"],
      certifications: ["AWS Certified Solutions Architect", "MongoDB Certified Developer"],
      languages: ["English (Native)", "Spanish (Intermediate)"]
    };
    
    // Templates data
    const templates = [
      { name: "Minimalist", description: "Clean & Simple", icon: "üìÑ", hasPhoto: false },
      { name: "Modern Blue", description: "Professional Blue", icon: "üíº", hasPhoto: false },
      { name: "Bold Dark", description: "Dramatic Contrast", icon: "‚ö´", hasPhoto: false },
      { name: "Creative Split", description: "Asymmetric Design", icon: "üé®", hasPhoto: false },
      { name: "Corporate Gray", description: "Traditional Formal", icon: "üè¢", hasPhoto: false },
      { name: "Elegant Serif", description: "Timeless Classic", icon: "‚ú®", hasPhoto: false },
      { name: "Gradient Neon", description: "Vibrant Startup Energy", icon: "üåà", hasPhoto: false },
      { name: "Monochrome Zigzag", description: "Bold Minimalist Statement", icon: "‚ö°", hasPhoto: false },
      { name: "Professional Photo", description: "Modern Two-Column with Photo", icon: "üì∏", hasPhoto: true },
      { name: "Executive Portrait", description: "Header Photo Layout", icon: "üëî", hasPhoto: true },
      { name: "Creative Profile", description: "Gradient Sidebar with Photo", icon: "üé≠", hasPhoto: true },
      { name: "Modern Minimal Photo", description: "Centered Photo Design", icon: "üì∑", hasPhoto: true },
      { name: "Tech Startup", description: "Bold Tech-Focused with Photo", icon: "üíª", hasPhoto: true }
    ];
    
    const fonts = ["Inter", "Lato", "Roboto", "Georgia", "Playfair Display", "Montserrat", "Orbitron", "Quicksand"];
    
    const colorPresets = [
      { name: "Professional Blue", accent: "#2563eb", background: "#ffffff", text: "#111827" },
      { name: "Elegant Gray", accent: "#6b7280", background: "#ffffff", text: "#1f2937" },
      { name: "Bold Red", accent: "#dc2626", background: "#ffffff", text: "#111827" },
      { name: "Creative Purple", accent: "#7c3aed", background: "#ffffff", text: "#111827" },
      { name: "Fresh Green", accent: "#059669", background: "#ffffff", text: "#111827" },
      { name: "Dark Mode", accent: "#3b82f6", background: "#1f2937", text: "#f9fafb" },
      { name: "Gradient Neon", accent: "#a726ff", background: "#18181b", text: "#fafaf9" },
      { name: "Monochrome Zigzag", accent: "#111827", background: "#fafafa", text: "#111827" }
    ];
    
    // Toast notification component
    const Toast = ({ message, type = 'success', onClose }) => {
      useEffect(() => {
        const timer = setTimeout(onClose, 3000);
        return () => clearTimeout(timer);
      }, [onClose]);
      
      const bgColor = type === 'error' ? '#ef4444' : type === 'info' ? '#3b82f6' : '#10b981';
      
      return (
        <div className="toast" style={{ backgroundColor: bgColor }}>
          {message}
        </div>
      );
    };
    
    // Landing Page Component
    const LandingPage = ({ onStartBuilding, onViewTemplates }) => {
      return (
        <div className="min-h-screen">
          {/* Hero Section */}
          <div className="gradient-hero min-h-screen flex items-center justify-center px-4">
            <div className="max-w-4xl mx-auto text-center animate-fade-in">
              <div className="text-6xl mb-6">üíº</div>
              <h1 className="text-4xl md:text-6xl font-bold text-gray-900 mb-6">
                Smart Resume Builder
              </h1>
              <p className="text-xl md:text-3xl text-gray-700 mb-4">
                Create Your Resume Your Way
              </p>
              <p className="text-lg md:text-xl text-gray-600 mb-8">
                No AI. Fully Customizable. Export-Ready. 100% Free.
              </p>
              <div className="flex items-center justify-center gap-4 mb-12 text-sm text-gray-600">
                <span className="flex items-center gap-1">
                  <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                    <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd"/>
                  </svg>
                  No Signup
                </span>
                <span className="flex items-center gap-1">
                  <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                    <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd"/>
                  </svg>
                  Private
                </span>
                <span className="flex items-center gap-1">
                  <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                    <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd"/>
                  </svg>
                  Free Forever
                </span>
              </div>
              <div className="flex flex-col sm:flex-row gap-4 justify-center">
                <button
                  onClick={onStartBuilding}
                  className="bg-blue-600 text-white px-8 py-4 rounded-xl text-lg font-semibold hover:bg-blue-700 transition shadow-lg hover:shadow-xl"
                >
                  Start Building
                </button>
                <button
                  onClick={onViewTemplates}
                  className="bg-white text-blue-600 px-8 py-4 rounded-xl text-lg font-semibold hover:bg-gray-50 transition border-2 border-blue-600 shadow-lg"
                >
                  View Templates
                </button>
              </div>
            </div>
          </div>
          
          {/* Features Section */}
          <div className="py-20 px-4 bg-white">
            <div className="max-w-6xl mx-auto">
              <h2 className="text-3xl md:text-4xl font-bold text-center text-gray-900 mb-4">Why Choose Our Resume Builder?</h2>
              <p className="text-center text-gray-600 mb-12 max-w-2xl mx-auto">
                Built with care for job seekers. No signup required, your data stays private, and it's completely free.
              </p>
              <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
                <div className="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-2xl shadow-lg hover:shadow-xl transition transform hover:-translate-y-1">
                  <div className="text-4xl mb-4">‚úçÔ∏è</div>
                  <h3 className="text-xl font-semibold mb-2">100% Manual Control</h3>
                  <p className="text-gray-600">No AI, you decide every word</p>
                </div>
                <div className="bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-2xl shadow-lg hover:shadow-xl transition transform hover:-translate-y-1">
                  <div className="text-4xl mb-4">üëÅÔ∏è</div>
                  <h3 className="text-xl font-semibold mb-2">Live Preview</h3>
                  <p className="text-gray-600">See changes in real-time</p>
                </div>
                <div className="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-2xl shadow-lg hover:shadow-xl transition transform hover:-translate-y-1">
                  <div className="text-4xl mb-4">üé®</div>
                  <h3 className="text-xl font-semibold mb-2">13 Pro Templates</h3>
                  <p className="text-gray-600">Including photo templates</p>
                </div>
                <div className="bg-gradient-to-br from-orange-50 to-red-50 p-6 rounded-2xl shadow-lg hover:shadow-xl transition transform hover:-translate-y-1">
                  <div className="text-4xl mb-4">üì•</div>
                  <h3 className="text-xl font-semibold mb-2">Smart Upload</h3>
                  <p className="text-gray-600">Parse PDF &amp; DOCX files</p>
                </div>
              </div>
            </div>
          </div>
          
          {/* Template Showcase */}
          <div id="templates" className="py-20 px-4 bg-gray-50">
            <div className="max-w-6xl mx-auto">
              <h2 className="text-3xl font-bold text-center text-gray-900 mb-4">Choose From 13 Professional Templates</h2>
              <p className="text-center text-gray-600 mb-12">From minimalist to photo-enhanced designs, find the perfect template for your career</p>
              <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                {templates.slice(0, 6).map((template, idx) => (
                  <div key={idx} className="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition transform hover:-translate-y-1">
                    <div className="text-5xl mb-4 text-center">{template.icon}</div>
                    <h3 className="text-xl font-semibold text-center mb-2">{template.name}</h3>
                    <p className="text-gray-600 text-center">{template.description}</p>
                  </div>
                ))}
              </div>
              <p className="text-center mt-8 text-gray-600">+ 7 more templates including photo-enhanced designs</p>
              <div className="text-center mt-12">
                <button
                  onClick={onStartBuilding}
                  className="bg-blue-600 text-white px-8 py-4 rounded-xl text-lg font-semibold hover:bg-blue-700 transition shadow-lg transform hover:scale-105"
                >
                  ‚ú® Get Started Now - It's Free!
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    };
    
    // Template Preview Thumbnail Component
    const TemplatePreviewThumbnail = ({ template }) => {
      const renderPreview = () => {
        switch(template.name) {
          case "Minimalist":
            return (
              <div className="w-full h-full bg-white p-3 text-xs">
                <div className="text-center border-b-2 border-blue-600 pb-2 mb-2">
                  <div className="font-bold text-sm mb-1">JOHN DOE</div>
                  <div className="text-blue-600 text-xs mb-1">Software Engineer</div>
                  <div className="text-[8px] text-gray-600">john@email.com ‚Ä¢ 555-1234</div>
                </div>
                <div className="mb-2">
                  <div className="font-bold text-[8px] text-blue-600 mb-1">SUMMARY</div>
                  <div className="space-y-0.5">
                    <div className="h-0.5 bg-gray-300 w-full"></div>
                    <div className="h-0.5 bg-gray-300 w-5/6"></div>
                  </div>
                </div>
                <div>
                  <div className="font-bold text-[8px] text-blue-600 mb-1">EXPERIENCE</div>
                  <div className="space-y-1">
                    <div className="h-1 bg-gray-800 w-3/4"></div>
                    <div className="h-0.5 bg-gray-400 w-1/2"></div>
                  </div>
                </div>
              </div>
            );
          case "Modern Blue":
            return (
              <div className="w-full h-full flex">
                <div className="w-1/3 bg-blue-600 p-2">
                  <div className="text-white text-xs font-bold mb-1">Name</div>
                  <div className="space-y-1">
                    <div className="h-1 bg-white w-full opacity-70"></div>
                    <div className="h-1 bg-white w-3/4 opacity-70"></div>
                  </div>
                </div>
                <div className="w-2/3 bg-white p-2">
                  <div className="space-y-1">
                    <div className="h-1 bg-gray-300 w-full"></div>
                    <div className="h-1 bg-gray-300 w-5/6"></div>
                    <div className="h-1 bg-gray-300 w-4/5"></div>
                  </div>
                </div>
              </div>
            );
          case "Bold Dark":
            return (
              <div className="w-full h-full">
                <div className="bg-gray-800 text-white p-2">
                  <div className="font-bold text-xs">NAME</div>
                  <div className="text-xs opacity-70">Title</div>
                </div>
                <div className="bg-white p-2 space-y-1">
                  <div className="h-1 bg-gray-300 w-full"></div>
                  <div className="h-1 bg-gray-300 w-4/5"></div>
                </div>
              </div>
            );
          case "Creative Split":
            return (
              <div className="w-full h-full flex">
                <div className="w-2/5 bg-blue-50 p-2">
                  <div className="w-8 h-8 rounded-full bg-blue-600 mb-1"></div>
                  <div className="space-y-1">
                    <div className="h-1 bg-gray-400 w-full"></div>
                    <div className="h-1 bg-gray-400 w-3/4"></div>
                  </div>
                </div>
                <div className="w-3/5 bg-white p-2 space-y-1">
                  <div className="h-1 bg-gray-300 w-full"></div>
                  <div className="h-1 bg-gray-300 w-5/6"></div>
                  <div className="h-1 bg-gray-300 w-4/5"></div>
                </div>
              </div>
            );
          case "Corporate Gray":
            return (
              <div className="w-full h-full bg-gray-50 p-4">
                <div className="text-center border-b border-gray-400 pb-2 mb-2">
                  <div className="font-bold text-xs">FULL NAME</div>
                  <div className="text-xs text-gray-600">Job Title</div>
                </div>
                <div className="space-y-1">
                  <div className="h-1 bg-gray-300 w-full"></div>
                  <div className="h-1 bg-gray-300 w-5/6"></div>
                </div>
              </div>
            );
          case "Elegant Serif":
            return (
              <div className="w-full h-full bg-white p-4 font-serif">
                <div className="text-center mb-2">
                  <div className="font-bold text-sm mb-1">Name</div>
                  <div className="h-px bg-blue-600 w-1/3 mx-auto mb-1"></div>
                  <div className="text-xs italic">Title</div>
                </div>
                <div className="space-y-1">
                  <div className="h-1 bg-gray-300 w-full"></div>
                  <div className="h-1 bg-gray-300 w-4/5"></div>
                </div>
              </div>
            );
          case "Gradient Neon":
            return (
              <div className="w-full h-full bg-gray-900">
                <div className="p-2" style={{ background: 'linear-gradient(90deg, #a726ff 0%, #f72585 33%, #ffba08 66%, #43e97b 100%)' }}>
                  <div className="text-white font-bold text-xs">NAME</div>
                  <div className="text-white text-xs opacity-90">Designer</div>
                </div>
                <div className="p-2 space-y-1">
                  <div className="h-1 bg-purple-500 w-full opacity-70"></div>
                  <div className="h-1 bg-pink-500 w-4/5 opacity-70"></div>
                  <div className="flex gap-1 mt-2">
                    <div className="h-3 w-3 rounded bg-purple-500"></div>
                    <div className="h-3 w-3 rounded bg-pink-500"></div>
                    <div className="h-3 w-3 rounded bg-yellow-500"></div>
                  </div>
                </div>
              </div>
            );
          case "Monochrome Zigzag":
            return (
              <div className="w-full h-full bg-white relative overflow-hidden">
                <div className="absolute inset-0" style={{ background: 'linear-gradient(135deg, #111827 0%, #111827 48%, transparent 48%, transparent 52%, #fafafa 52%)' }}>
                  <div className="p-2 text-white">
                    <div className="font-bold text-xs">NAME</div>
                  </div>
                </div>
                <div className="absolute bottom-2 right-2 space-y-1">
                  <div className="h-1 bg-gray-800 w-16"></div>
                  <div className="h-1 bg-gray-800 w-12"></div>
                </div>
              </div>
            );
          case "Professional Photo":
            return (
              <div className="w-full h-full flex">
                <div className="w-2/5 bg-blue-50 p-2 flex flex-col items-center">
                  <div className="w-12 h-12 rounded-full bg-blue-600 mb-1"></div>
                  <div className="space-y-0.5 w-full px-1">
                    <div className="h-0.5 bg-gray-400 w-full"></div>
                    <div className="h-0.5 bg-gray-400 w-3/4"></div>
                  </div>
                </div>
                <div className="w-3/5 bg-white p-2">
                  <div className="space-y-1">
                    <div className="h-1 bg-blue-600 w-3/4"></div>
                    <div className="h-0.5 bg-gray-300 w-full"></div>
                    <div className="h-0.5 bg-gray-300 w-5/6"></div>
                  </div>
                </div>
              </div>
            );
          case "Executive Portrait":
            return (
              <div className="w-full h-full bg-gray-700">
                <div className="p-2 flex items-center gap-2">
                  <div className="w-10 h-10 rounded-full bg-white opacity-80"></div>
                  <div className="flex-1">
                    <div className="h-1 bg-white w-2/3 mb-1"></div>
                    <div className="h-0.5 bg-white opacity-70 w-1/2"></div>
                  </div>
                </div>
                <div className="bg-white p-2 space-y-1">
                  <div className="h-1 bg-gray-800 w-full"></div>
                  <div className="h-0.5 bg-gray-400 w-4/5"></div>
                </div>
              </div>
            );
          case "Creative Profile":
            return (
              <div className="w-full h-full flex">
                <div className="w-2/5 p-2" style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
                  <div className="w-12 h-12 rounded-lg bg-white opacity-30 mb-1"></div>
                  <div className="space-y-1">
                    <div className="h-1 bg-white w-full opacity-80"></div>
                    <div className="h-0.5 bg-white w-3/4 opacity-60"></div>
                  </div>
                </div>
                <div className="w-3/5 bg-white p-2 space-y-1">
                  <div className="h-1 bg-purple-600 w-2/3"></div>
                  <div className="h-0.5 bg-gray-300 w-full"></div>
                  <div className="h-0.5 bg-gray-300 w-5/6"></div>
                </div>
              </div>
            );
          case "Modern Minimal Photo":
            return (
              <div className="w-full h-full bg-white p-2">
                <div className="flex flex-col items-center mb-2">
                  <div className="w-10 h-10 rounded-full bg-blue-600 mb-1"></div>
                  <div className="h-1 bg-gray-800 w-2/3 mb-0.5"></div>
                  <div className="h-0.5 bg-blue-600 w-1/2"></div>
                </div>
                <div className="space-y-1">
                  <div className="h-0.5 bg-gray-300 w-full"></div>
                  <div className="h-0.5 bg-gray-300 w-5/6"></div>
                  <div className="h-0.5 bg-gray-300 w-4/5"></div>
                </div>
              </div>
            );
          case "Tech Startup":
            return (
              <div className="w-full h-full bg-gray-900">
                <div className="bg-gray-800 p-2 flex items-center gap-2">
                  <div className="w-10 h-10 rounded bg-cyan-500"></div>
                  <div className="flex-1">
                    <div className="h-1 bg-cyan-500 w-2/3 mb-1"></div>
                    <div className="h-0.5 bg-white opacity-70 w-1/2"></div>
                  </div>
                </div>
                <div className="p-2 space-y-1">
                  <div className="h-0.5 bg-gray-600 w-full"></div>
                  <div className="h-0.5 bg-gray-600 w-4/5"></div>
                </div>
              </div>
            );
          default:
            return (
              <div className="w-full h-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                <div className="text-4xl">{template.icon}</div>
              </div>
            );
        }
      };
      
      return (
        <div className="h-64 overflow-hidden bg-gray-100 rounded-t-2xl">
          {renderPreview()}
        </div>
      );
    };
    
    // Template Gallery Component
    const TemplateGallery = ({ onSelectTemplate, onBack }) => {
      return (
        <div className="min-h-screen bg-gray-50 py-12 px-4">
          <div className="max-w-6xl mx-auto">
            <button
              onClick={onBack}
              className="mb-8 text-blue-600 hover:text-blue-700 font-semibold flex items-center gap-2"
            >
              ‚Üê Back to Home
            </button>
            <h1 className="text-4xl font-bold text-center mb-4">Choose Your Template</h1>
            <p className="text-center text-gray-600 mb-12">Select a template to get started. You can change it anytime.</p>
            
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
              {templates.map((template, idx) => (
                <div key={idx} className="bg-white rounded-2xl shadow-lg overflow-hidden hover:shadow-2xl transition transform hover:scale-105 animate-fade-in">
                  <div className="relative">
                    <TemplatePreviewThumbnail template={template} />
                    {template.hasPhoto && (
                      <div className="absolute top-3 right-3 bg-blue-600 text-white px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-1 shadow-lg">
                        üì∏ Photo
                      </div>
                    )}
                  </div>
                  <div className="p-6">
                    <h3 className="text-2xl font-bold mb-2">{template.name}</h3>
                    <p className="text-gray-600 mb-4">{template.description}</p>
                    <button
                      onClick={() => onSelectTemplate(template.name)}
                      className="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition"
                    >
                      Use Template
                    </button>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    };
    
    // Data Input Choice Component
    const DataInputChoice = ({ onManualInput, onUpload, onBack }) => {
      const fileInputRef = useRef(null);
      
      const handleFileSelect = (e) => {
        const file = e.target.files[0];
        if (file) {
          onUpload(file);
        }
      };
      
      return (
        <div className="min-h-screen bg-gray-50 flex items-center justify-center px-4">
          <div className="max-w-4xl w-full">
            <button
              onClick={onBack}
              className="mb-8 text-blue-600 hover:text-blue-700 font-semibold flex items-center gap-2"
            >
              ‚Üê Back
            </button>
            <h1 className="text-4xl font-bold text-center mb-4">How would you like to start?</h1>
            <p className="text-center text-gray-600 mb-12">Choose your preferred method to build your resume. Don't worry, you can edit everything later!</p>
            
            <div className="grid md:grid-cols-2 gap-8">
              {/* Manual Input */}
              <div className="bg-white rounded-2xl shadow-xl p-8 hover:shadow-2xl transition animate-fade-in">
                <div className="text-6xl mb-6 text-center">üìù</div>
                <h2 className="text-2xl font-bold mb-4 text-center">Fill Details Manually</h2>
                <p className="text-gray-600 mb-8 text-center">Start from scratch and build your resume step by step</p>
                <button
                  onClick={onManualInput}
                  className="w-full bg-blue-600 text-white py-4 rounded-xl font-semibold hover:bg-blue-700 transition text-lg"
                >
                  Start Building
                </button>
              </div>
              
              {/* Upload */}
              <div className="bg-white rounded-2xl shadow-xl p-8 hover:shadow-2xl transition animate-fade-in">
                <div className="text-6xl mb-6 text-center">üì§</div>
                <h2 className="text-2xl font-bold mb-4 text-center">Upload Existing Resume</h2>
                <p className="text-gray-600 mb-8 text-center">Upload PDF or DOCX and we'll extract the text for you</p>
                <input
                  ref={fileInputRef}
                  type="file"
                  accept=".pdf,.docx,.doc,.txt"
                  onChange={handleFileSelect}
                  className="hidden"
                />
                <button
                  onClick={() => fileInputRef.current.click()}
                  className="w-full bg-indigo-600 text-white py-4 rounded-xl font-semibold hover:bg-indigo-700 transition text-lg"
                >
                  Upload &amp; Edit
                </button>
                <p className="text-sm text-gray-500 mt-4 text-center">Accepts PDF, DOCX, DOC, TXT</p>
              </div>
            </div>
            
            {/* Load Sample Data */}
            <div className="mt-8 text-center">
              <button
                onClick={() => onManualInput(true)}
                className="text-blue-600 hover:text-blue-700 font-semibold underline inline-flex items-center gap-2"
              >
                <span>üéØ</span>
                <span>Or try with sample data to see how it works</span>
              </button>
            </div>
          </div>
        </div>
      );
    };
    
    // Main Builder Component
    const Builder = ({ resumeData, setResumeData, onBack, onExport }) => {
      const [activeSection, setActiveSection] = useState('personal');
      const [autoSaveStatus, setAutoSaveStatus] = useState('saved');
      const [showPreview, setShowPreview] = useState(false);
      const [validationErrors, setValidationErrors] = useState({});
      const saveTimerRef = useRef(null);
      
      // Auto-save simulation (localStorage not available in sandbox)
      useEffect(() => {
        if (saveTimerRef.current) {
          clearTimeout(saveTimerRef.current);
        }
        
        setAutoSaveStatus('saving');
        saveTimerRef.current = setTimeout(() => {
          setAutoSaveStatus('saved');
        }, 3000);
        
        return () => {
          if (saveTimerRef.current) {
            clearTimeout(saveTimerRef.current);
          }
        };
      }, [resumeData]);
      
      const updatePersonalInfo = (field, value) => {
        let processedValue = value;
        
        // Auto-formatting
        if (field === 'fullName' || field === 'jobTitle') {
          // Capitalize first letter of each word
          processedValue = value.split(' ').map(word => 
            word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
          ).join(' ');
        }
        
        if (field === 'phone') {
          // Auto-format phone number (XXX) XXX-XXXX
          const digits = value.replace(/\D/g, '');
          if (digits.length <= 3) {
            processedValue = digits;
          } else if (digits.length <= 6) {
            processedValue = `(${digits.slice(0, 3)}) ${digits.slice(3)}`;
          } else if (digits.length <= 10) {
            processedValue = `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6)}`;
          } else {
            processedValue = `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6, 10)}`;
          }
        }
        
        if ((field === 'website' || field === 'linkedin' || field === 'github') && value && !value.startsWith('http')) {
          // Auto-add https:// to URLs
          if (value.includes('.') || value.includes('linkedin') || value.includes('github')) {
            processedValue = 'https://' + value;
          }
        }
        
        setResumeData(prev => ({
          ...prev,
          personalInfo: { ...prev.personalInfo, [field]: processedValue }
        }));
        
        // Clear validation error when user starts typing
        if (validationErrors[field]) {
          setValidationErrors(prev => {
            const newErrors = { ...prev };
            delete newErrors[field];
            return newErrors;
          });
        }
      };
      
      const addExperience = () => {
        setResumeData(prev => ({
          ...prev,
          experience: [...prev.experience, {
            jobTitle: "",
            company: "",
            location: "",
            startDate: "",
            endDate: "",
            description: ""
          }]
        }));
      };
      
      const updateExperience = (index, field, value) => {
        setResumeData(prev => ({
          ...prev,
          experience: prev.experience.map((exp, i) => 
            i === index ? { ...exp, [field]: value } : exp
          )
        }));
      };
      
      const deleteExperience = (index) => {
        setResumeData(prev => ({
          ...prev,
          experience: prev.experience.filter((_, i) => i !== index)
        }));
      };
      
      const addEducation = () => {
        setResumeData(prev => ({
          ...prev,
          education: [...prev.education, {
            degree: "",
            institution: "",
            year: "",
            description: ""
          }]
        }));
      };
      
      const updateEducation = (index, field, value) => {
        setResumeData(prev => ({
          ...prev,
          education: prev.education.map((edu, i) => 
            i === index ? { ...edu, [field]: value } : edu
          )
        }));
      };
      
      const deleteEducation = (index) => {
        setResumeData(prev => ({
          ...prev,
          education: prev.education.filter((_, i) => i !== index)
        }));
      };
      
      const addProject = () => {
        setResumeData(prev => ({
          ...prev,
          projects: [...prev.projects, {
            title: "",
            role: "",
            description: "",
            technologies: "",
            link: ""
          }]
        }));
      };
      
      const updateProject = (index, field, value) => {
        setResumeData(prev => ({
          ...prev,
          projects: prev.projects.map((proj, i) => 
            i === index ? { ...proj, [field]: value } : proj
          )
        }));
      };
      
      const deleteProject = (index) => {
        setResumeData(prev => ({
          ...prev,
          projects: prev.projects.filter((_, i) => i !== index)
        }));
      };
      
      const addSkill = (skill) => {
        if (skill && !resumeData.skills.includes(skill)) {
          setResumeData(prev => ({
            ...prev,
            skills: [...prev.skills, skill]
          }));
        }
      };
      
      const removeSkill = (index) => {
        setResumeData(prev => ({
          ...prev,
          skills: prev.skills.filter((_, i) => i !== index)
        }));
      };
      
      // Validate form before export
      const validateForm = () => {
        const errors = {};
        
        if (!resumeData.personalInfo.fullName) {
          errors.fullName = 'Name is required';
        }
        
        if (!resumeData.personalInfo.email) {
          errors.email = 'Email is required';
        } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(resumeData.personalInfo.email)) {
          errors.email = 'Invalid email format';
        }
        
        if (resumeData.personalInfo.phone && !/^[\d\s()+-]+$/.test(resumeData.personalInfo.phone)) {
          errors.phone = 'Invalid phone number';
        }
        
        setValidationErrors(errors);
        return Object.keys(errors).length === 0;
      };
      
      const addListItem = (field, value) => {
        if (value) {
          setResumeData(prev => ({
            ...prev,
            [field]: [...prev[field], value]
          }));
        }
      };
      
      const removeListItem = (field, index) => {
        setResumeData(prev => ({
          ...prev,
          [field]: prev[field].filter((_, i) => i !== index)
        }));
      };
      
      // Custom fields management
      const addCustomField = () => {
        const newField = {
          id: `custom_${Date.now()}`,
          title: 'New Section',
          content: '',
          type: 'text',
          isCustom: true
        };
        setResumeData(prev => ({
          ...prev,
          customFields: [...(prev.customFields || []), newField]
        }));
      };
      
      const updateCustomField = (index, field, value) => {
        setResumeData(prev => ({
          ...prev,
          customFields: prev.customFields.map((cf, i) => 
            i === index ? { ...cf, [field]: value } : cf
          )
        }));
      };
      
      const deleteCustomField = (index) => {
        setResumeData(prev => ({
          ...prev,
          customFields: prev.customFields.filter((_, i) => i !== index)
        }));
      };
      
      return (
        <div className="min-h-screen bg-gray-50">
          {/* Header */}
          <div className="bg-white shadow-md sticky top-0 z-50">
            <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
              <div className="flex items-center gap-4">
                <button onClick={onBack} className="text-gray-600 hover:text-gray-900">
                  ‚Üê Back
                </button>
                <h1 className="text-xl font-bold">Resume Builder</h1>
                <span className={`text-sm px-3 py-1 rounded-full ${
                  autoSaveStatus === 'saved' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'
                }`}>
                  {autoSaveStatus === 'saved' ? '‚úì Saved' : '‚è≥ Saving...'}
                </span>
              </div>
              <div className="flex gap-2">
                <button
                  onClick={() => setShowPreview(!showPreview)}
                  className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"
                >
                  {showPreview ? 'Hide Preview' : 'Show Preview'}
                </button>
                <button
                  onClick={onExport}
                  className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold"
                >
                  Export PDF
                </button>
              </div>
            </div>
          </div>
          
          {/* Main Content */}
          <div className="max-w-7xl mx-auto px-4 py-8">
            <div className={showPreview ? 'builder-grid' : ''}>
              {/* Preview Panel - LEFT SIDE */}
              {showPreview && (
                <div className="bg-white rounded-xl shadow-lg p-4 md:p-6 preview-sticky">
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-lg md:text-xl font-bold">Live Preview</h2>
                    <button
                      onClick={onExport}
                      className="px-3 py-2 md:px-4 md:py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm"
                    >
                      üì• Export
                    </button>
                  </div>
                  <div className="overflow-auto" style={{ maxHeight: '700px' }}>
                    <ResumePreview data={resumeData} />
                  </div>
                </div>
              )}
              
              {/* Form Panel - RIGHT SIDE */}
              <div className="bg-white rounded-xl shadow-lg p-6 space-y-6">
                {/* Section Navigation */}
                <div className="flex flex-wrap gap-2 border-b pb-4">
                  {['personal', 'summary', 'experience', 'education', 'projects', 'skills', 'custom', 'additional'].map(section => (
                    <button
                      key={section}
                      onClick={() => setActiveSection(section)}
                      className={`px-4 py-2 rounded-lg font-medium transition ${
                        activeSection === section
                          ? 'bg-blue-600 text-white'
                          : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                      }`}
                    >
                      {section.charAt(0).toUpperCase() + section.slice(1)}
                    </button>
                  ))}
                </div>
                
                {/* Personal Information */}
                {activeSection === 'personal' && (
                  <div className="space-y-4">
                    <h2 className="text-2xl font-bold mb-4">Personal Information</h2>
                    
                    {/* Photo Upload */}
                    <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-4">
                      <div className="flex items-center justify-between mb-2">
                        <label className="block text-sm font-medium">Profile Photo</label>
                        {resumeData.template && templates.find(t => t.name === resumeData.template)?.hasPhoto && (
                          <span className="text-xs bg-blue-600 text-white px-2 py-1 rounded-full">‚ú® Supported</span>
                        )}
                      </div>
                      <div className="flex items-center gap-4">
                        {resumeData.personalInfo.photoUrl ? (
                          <div className="relative">
                            <img 
                              src={resumeData.personalInfo.photoUrl} 
                              alt="Profile" 
                              className="w-24 h-24 rounded-full object-cover border-4 border-white shadow-lg"
                            />
                            <button
                              onClick={() => updatePersonalInfo('photoUrl', '')}
                              className="absolute -top-2 -right-2 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-700 transition"
                              title="Remove photo"
                            >
                              ‚úï
                            </button>
                          </div>
                        ) : (
                          <div className="w-24 h-24 rounded-full bg-gray-200 flex items-center justify-center text-4xl text-gray-400">
                            üë§
                          </div>
                        )}
                        <div className="flex-1">
                          <input
                            type="file"
                            id="photoUpload"
                            accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
                            onChange={(e) => {
                              const file = e.target.files[0];
                              if (file) {
                                if (file.size > 5 * 1024 * 1024) {
                                  alert('File size must be less than 5MB');
                                  return;
                                }
                                const reader = new FileReader();
                                reader.onload = (event) => {
                                  updatePersonalInfo('photoUrl', event.target.result);
                                };
                                reader.readAsDataURL(file);
                              }
                            }}
                            className="hidden"
                          />
                          <button
                            onClick={() => document.getElementById('photoUpload').click()}
                            className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition text-sm font-medium"
                          >
                            {resumeData.personalInfo.photoUrl ? 'Change Photo' : 'Upload Photo'}
                          </button>
                          <p className="text-xs text-gray-600 mt-2">Accepts: JPG, PNG, GIF, WEBP (Max 5MB)</p>
                          {resumeData.personalInfo.photoUrl && (
                            <button
                              onClick={() => updatePersonalInfo('photoUrl', '')}
                              className="text-sm text-red-600 hover:text-red-700 mt-2"
                            >
                              Remove Photo
                            </button>
                          )}
                        </div>
                      </div>
                    </div>
                    
                    <div className="grid md:grid-cols-2 gap-4">
                      <div>
                        <label className="block text-sm font-medium mb-1">Full Name *</label>
                        <input
                          type="text"
                          value={resumeData.personalInfo.fullName}
                          onChange={(e) => updatePersonalInfo('fullName', e.target.value)}
                          className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                          placeholder="John Doe"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">Job Title *</label>
                        <input
                          type="text"
                          value={resumeData.personalInfo.jobTitle}
                          onChange={(e) => updatePersonalInfo('jobTitle', e.target.value)}
                          className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                          placeholder="Software Engineer"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">Email *</label>
                        <input
                          type="email"
                          value={resumeData.personalInfo.email}
                          onChange={(e) => updatePersonalInfo('email', e.target.value)}
                          className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                          placeholder="john@example.com"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">Phone</label>
                        <input
                          type="tel"
                          value={resumeData.personalInfo.phone}
                          onChange={(e) => updatePersonalInfo('phone', e.target.value)}
                          className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                          placeholder="+1 (555) 123-4567"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">Location</label>
                        <input
                          type="text"
                          value={resumeData.personalInfo.location}
                          onChange={(e) => updatePersonalInfo('location', e.target.value)}
                          className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                          placeholder="New York, NY"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">LinkedIn</label>
                        <input
                          type="url"
                          value={resumeData.personalInfo.linkedin}
                          onChange={(e) => updatePersonalInfo('linkedin', e.target.value)}
                          className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                          placeholder="linkedin.com/in/johndoe"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">Website/Portfolio</label>
                        <input
                          type="url"
                          value={resumeData.personalInfo.website}
                          onChange={(e) => updatePersonalInfo('website', e.target.value)}
                          className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                          placeholder="johndoe.com"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">GitHub</label>
                        <input
                          type="url"
                          value={resumeData.personalInfo.github}
                          onChange={(e) => updatePersonalInfo('github', e.target.value)}
                          className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                          placeholder="github.com/johndoe"
                        />
                      </div>
                    </div>
                  </div>
                )}
                
                {/* Professional Summary */}
                {activeSection === 'summary' && (
                  <div className="space-y-4">
                    <h2 className="text-2xl font-bold mb-4">Professional Summary</h2>
                    <div>
                      <label className="block text-sm font-medium mb-1">Summary</label>
                      <textarea
                        value={resumeData.summary}
                        onChange={(e) => setResumeData(prev => ({ ...prev, summary: e.target.value }))}
                        rows="6"
                        maxLength="500"
                        className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                        placeholder="Write a brief summary about yourself, your experience, and what makes you unique..."
                      />
                      <p className="text-sm text-gray-500 mt-1">
                        {resumeData.summary.length}/500 characters
                        {resumeData.summary.length > 400 && (
                          <span className="text-orange-600 ml-2">‚ö†Ô∏è Keep it concise</span>
                        )}
                      </p>
                    </div>
                  </div>
                )}
                
                {/* Experience */}
                {activeSection === 'experience' && (
                  <div className="space-y-4">
                    <div className="flex justify-between items-center mb-4">
                      <h2 className="text-2xl font-bold">Work Experience</h2>
                      <button
                        onClick={addExperience}
                        className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
                      >
                        + Add Experience
                      </button>
                    </div>
                    {resumeData.experience.length === 0 ? (
                      <p className="text-gray-500 text-center py-8">No experience added yet. Click "Add Experience" to get started.</p>
                    ) : (
                      resumeData.experience.map((exp, index) => (
                        <div key={index} className="border rounded-lg p-4 space-y-3 bg-gray-50">
                          <div className="flex justify-between items-start">
                            <h3 className="font-semibold">Experience {index + 1}</h3>
                            <button
                              onClick={() => deleteExperience(index)}
                              className="text-red-600 hover:text-red-700"
                            >
                              ‚úï Delete
                            </button>
                          </div>
                          <div className="grid md:grid-cols-2 gap-3">
                            <div>
                              <label className="block text-sm font-medium mb-1">Job Title</label>
                              <input
                                type="text"
                                value={exp.jobTitle}
                                onChange={(e) => updateExperience(index, 'jobTitle', e.target.value)}
                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                placeholder="Senior Developer"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Company</label>
                              <input
                                type="text"
                                value={exp.company}
                                onChange={(e) => updateExperience(index, 'company', e.target.value)}
                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                placeholder="Tech Corp"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Location</label>
                              <input
                                type="text"
                                value={exp.location}
                                onChange={(e) => updateExperience(index, 'location', e.target.value)}
                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                placeholder="New York, NY"
                              />
                            </div>
                            <div className="grid grid-cols-2 gap-2">
                              <div>
                                <label className="block text-sm font-medium mb-1">Start Date</label>
                                <input
                                  type="month"
                                  value={exp.startDate}
                                  onChange={(e) => updateExperience(index, 'startDate', e.target.value)}
                                  className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                  title="Select start month and year"
                                />
                              </div>
                              <div>
                                <label className="block text-sm font-medium mb-1">
                                  End Date
                                  <span className="text-xs text-gray-500 ml-1">(or "Present")</span>
                                </label>
                                <input
                                  type="text"
                                  value={exp.endDate}
                                  onChange={(e) => updateExperience(index, 'endDate', e.target.value)}
                                  className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                  placeholder="Present or 2024-03"
                                  title="Type 'Present' if currently working, or select end date"
                                />
                              </div>
                            </div>
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">
                              Description
                              <span className="text-xs text-gray-500 ml-2">üí° Use bullet points for impact</span>
                            </label>
                            <textarea
                              value={exp.description}
                              onChange={(e) => updateExperience(index, 'description', e.target.value)}
                              rows="4"
                              className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                              placeholder="‚Ä¢ Led team of 5 developers to build scalable web app\n‚Ä¢ Improved performance by 40% through optimization\n‚Ä¢ Implemented CI/CD pipeline reducing deployment time"
                            />
                            <p className="text-xs text-gray-500 mt-1">
                              <strong>Tip:</strong> Start with action verbs (Led, Built, Improved, Designed)
                            </p>
                          </div>
                        </div>
                      ))
                    )}
                  </div>
                )}
                
                {/* Education */}
                {activeSection === 'education' && (
                  <div className="space-y-4">
                    <div className="flex justify-between items-center mb-4">
                      <h2 className="text-2xl font-bold">Education</h2>
                      <button
                        onClick={addEducation}
                        className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
                      >
                        + Add Education
                      </button>
                    </div>
                    {resumeData.education.length === 0 ? (
                      <p className="text-gray-500 text-center py-8">No education added yet. Click "Add Education" to get started.</p>
                    ) : (
                      resumeData.education.map((edu, index) => (
                        <div key={index} className="border rounded-lg p-4 space-y-3 bg-gray-50">
                          <div className="flex justify-between items-start">
                            <h3 className="font-semibold">Education {index + 1}</h3>
                            <button
                              onClick={() => deleteEducation(index)}
                              className="text-red-600 hover:text-red-700"
                            >
                              ‚úï Delete
                            </button>
                          </div>
                          <div className="grid md:grid-cols-2 gap-3">
                            <div>
                              <label className="block text-sm font-medium mb-1">Degree</label>
                              <input
                                type="text"
                                value={edu.degree}
                                onChange={(e) => updateEducation(index, 'degree', e.target.value)}
                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                placeholder="Bachelor of Science in Computer Science"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Institution</label>
                              <input
                                type="text"
                                value={edu.institution}
                                onChange={(e) => updateEducation(index, 'institution', e.target.value)}
                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                placeholder="University Name"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Year</label>
                              <input
                                type="text"
                                value={edu.year}
                                onChange={(e) => updateEducation(index, 'year', e.target.value)}
                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                placeholder="2020 or 2016-2020"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Description (Optional)</label>
                              <input
                                type="text"
                                value={edu.description}
                                onChange={(e) => updateEducation(index, 'description', e.target.value)}
                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                placeholder="GPA: 3.8/4.0"
                              />
                            </div>
                          </div>
                        </div>
                      ))
                    )}
                  </div>
                )}
                
                {/* Projects */}
                {activeSection === 'projects' && (
                  <div className="space-y-4">
                    <div className="flex justify-between items-center mb-4">
                      <h2 className="text-2xl font-bold">Projects</h2>
                      <button
                        onClick={addProject}
                        className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
                      >
                        + Add Project
                      </button>
                    </div>
                    {resumeData.projects.length === 0 ? (
                      <p className="text-gray-500 text-center py-8">No projects added yet. Click "Add Project" to get started.</p>
                    ) : (
                      resumeData.projects.map((proj, index) => (
                        <div key={index} className="border rounded-lg p-4 space-y-3 bg-gray-50">
                          <div className="flex justify-between items-start">
                            <h3 className="font-semibold">Project {index + 1}</h3>
                            <button
                              onClick={() => deleteProject(index)}
                              className="text-red-600 hover:text-red-700"
                            >
                              ‚úï Delete
                            </button>
                          </div>
                          <div className="grid md:grid-cols-2 gap-3">
                            <div>
                              <label className="block text-sm font-medium mb-1">Project Title</label>
                              <input
                                type="text"
                                value={proj.title}
                                onChange={(e) => updateProject(index, 'title', e.target.value)}
                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                placeholder="E-Commerce Platform"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Your Role</label>
                              <input
                                type="text"
                                value={proj.role}
                                onChange={(e) => updateProject(index, 'role', e.target.value)}
                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                placeholder="Lead Developer"
                              />
                            </div>
                          </div>
                          <div>
                            <label className="block text-sm font-medium mb-1">Description</label>
                            <textarea
                              value={proj.description}
                              onChange={(e) => updateProject(index, 'description', e.target.value)}
                              rows="3"
                              className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                              placeholder="Describe the project and your contributions..."
                            />
                          </div>
                          <div className="grid md:grid-cols-2 gap-3">
                            <div>
                              <label className="block text-sm font-medium mb-1">Technologies</label>
                              <input
                                type="text"
                                value={proj.technologies}
                                onChange={(e) => updateProject(index, 'technologies', e.target.value)}
                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                placeholder="React, Node.js, MongoDB"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Link (Optional)</label>
                              <input
                                type="url"
                                value={proj.link}
                                onChange={(e) => updateProject(index, 'link', e.target.value)}
                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                placeholder="github.com/project"
                              />
                            </div>
                          </div>
                        </div>
                      ))
                    )}
                  </div>
                )}
                
                {/* Skills */}
                {activeSection === 'skills' && (
                  <div className="space-y-4">
                    <h2 className="text-2xl font-bold mb-4">Skills</h2>
                    <div>
                      <label className="block text-sm font-medium mb-1">Add Skill</label>
                      <SkillsInput skills={resumeData.skills} onAddSkill={addSkill} onRemoveSkill={removeSkill} />
                    </div>
                  </div>
                )}
                
                {/* Custom Sections */}
                {activeSection === 'custom' && (
                  <div className="space-y-6">
                    <div className="flex justify-between items-center mb-4">
                      <h2 className="text-2xl font-bold">Custom Sections</h2>
                      <button
                        onClick={addCustomField}
                        className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition"
                      >
                        + Add Custom Section
                      </button>
                    </div>
                    
                    {(!resumeData.customFields || resumeData.customFields.length === 0) ? (
                      <div className="text-center py-12 bg-purple-50 rounded-lg border-2 border-dashed border-purple-200">
                        <div className="text-5xl mb-4">‚ú®</div>
                        <p className="text-gray-600 mb-2">No custom sections yet</p>
                        <p className="text-sm text-gray-500 mb-4">Add sections like "Professional Memberships", "Patents", "Speaking Engagements", etc.</p>
                        <button
                          onClick={addCustomField}
                          className="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-semibold"
                        >
                          Create Your First Custom Section
                        </button>
                      </div>
                    ) : (
                      <div className="space-y-4">
                        {resumeData.customFields.map((field, index) => (
                          <div key={field.id || index} className="border-2 border-purple-200 rounded-lg p-4 space-y-3 bg-purple-50">
                            <div className="flex justify-between items-start">
                              <div className="flex items-center gap-2">
                                <h3 className="font-semibold text-purple-900">Custom Section {index + 1}</h3>
                                {field.createdFromUpload && (
                                  <span className="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">Auto-detected</span>
                                )}
                              </div>
                              <button
                                onClick={() => deleteCustomField(index)}
                                className="text-red-600 hover:text-red-700 font-bold"
                              >
                                ‚úï Delete
                              </button>
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Section Title</label>
                              <input
                                type="text"
                                value={field.title}
                                onChange={(e) => updateCustomField(index, 'title', e.target.value)}
                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                                placeholder="e.g., Professional Memberships, Patents, Speaking Engagements"
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium mb-1">Content</label>
                              <textarea
                                value={field.content}
                                onChange={(e) => updateCustomField(index, 'content', e.target.value)}
                                rows="5"
                                className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 outline-none"
                                placeholder="Add your content here...\n\n‚Ä¢ You can use bullet points\n‚Ä¢ Multiple lines\n‚Ä¢ Or paragraphs"
                              />
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                    
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                      <h4 className="font-semibold text-blue-900 mb-2">üí° Custom Section Ideas:</h4>
                      <div className="grid grid-cols-2 gap-2 text-sm text-blue-800">
                        <div>‚Ä¢ Professional Memberships</div>
                        <div>‚Ä¢ Speaking Engagements</div>
                        <div>‚Ä¢ Patents</div>
                        <div>‚Ä¢ Media Coverage</div>
                        <div>‚Ä¢ Teaching Experience</div>
                        <div>‚Ä¢ Military Service</div>
                        <div>‚Ä¢ Test Scores (GRE, GMAT)</div>
                        <div>‚Ä¢ Advisory Roles</div>
                      </div>
                    </div>
                  </div>
                )}
                
                {/* Additional Sections */}
                {activeSection === 'additional' && (
                  <div className="space-y-6">
                    <h2 className="text-2xl font-bold mb-4">Additional Sections</h2>
                    
                    {/* Certifications */}
                    <div>
                      <h3 className="text-lg font-semibold mb-2">Certifications</h3>
                      <div className="flex gap-2 mb-2">
                        <input
                          type="text"
                          id="certInput"
                          className="flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                          placeholder="Add a certification"
                          onKeyPress={(e) => {
                            if (e.key === 'Enter') {
                              addListItem('certifications', e.target.value.trim());
                              e.target.value = '';
                            }
                          }}
                        />
                        <button
                          onClick={() => {
                            const input = document.getElementById('certInput');
                            addListItem('certifications', input.value.trim());
                            input.value = '';
                          }}
                          className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition"
                        >
                          Add
                        </button>
                      </div>
                      <ul className="space-y-2">
                        {resumeData.certifications.map((cert, index) => (
                          <li key={index} className="flex justify-between items-center bg-gray-50 px-3 py-2 rounded-lg">
                            <span>{cert}</span>
                            <button
                              onClick={() => removeListItem('certifications', index)}
                              className="text-red-600 hover:text-red-700"
                            >
                              ‚úï
                            </button>
                          </li>
                        ))}
                      </ul>
                    </div>
                    
                    {/* Languages */}
                    <div>
                      <h3 className="text-lg font-semibold mb-2">Languages</h3>
                      <div className="flex gap-2 mb-2">
                        <input
                          type="text"
                          id="langInput"
                          className="flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                          placeholder="e.g., English (Native)"
                          onKeyPress={(e) => {
                            if (e.key === 'Enter') {
                              addListItem('languages', e.target.value.trim());
                              e.target.value = '';
                            }
                          }}
                        />
                        <button
                          onClick={() => {
                            const input = document.getElementById('langInput');
                            addListItem('languages', input.value.trim());
                            input.value = '';
                          }}
                          className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition"
                        >
                          Add
                        </button>
                      </div>
                      <ul className="space-y-2">
                        {resumeData.languages.map((lang, index) => (
                          <li key={index} className="flex justify-between items-center bg-gray-50 px-3 py-2 rounded-lg">
                            <span>{lang}</span>
                            <button
                              onClick={() => removeListItem('languages', index)}
                              className="text-red-600 hover:text-red-700"
                            >
                              ‚úï
                            </button>
                          </li>
                        ))}
                      </ul>
                    </div>
                    
                    {/* Achievements */}
                    <div>
                      <h3 className="text-lg font-semibold mb-2">Achievements</h3>
                      <div className="flex gap-2 mb-2">
                        <input
                          type="text"
                          id="achieveInput"
                          className="flex-1 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                          placeholder="Add an achievement"
                          onKeyPress={(e) => {
                            if (e.key === 'Enter') {
                              addListItem('achievements', e.target.value.trim());
                              e.target.value = '';
                            }
                          }}
                        />
                        <button
                          onClick={() => {
                            const input = document.getElementById('achieveInput');
                            addListItem('achievements', input.value.trim());
                            input.value = '';
                          }}
                          className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition"
                        >
                          Add
                        </button>
                      </div>
                      <ul className="space-y-2">
                        {resumeData.achievements.map((achieve, index) => (
                          <li key={index} className="flex justify-between items-center bg-gray-50 px-3 py-2 rounded-lg">
                            <span>{achieve}</span>
                            <button
                              onClick={() => removeListItem('achievements', index)}
                              className="text-red-600 hover:text-red-700"
                            >
                              ‚úï
                            </button>
                          </li>
                        ))}
                      </ul>
                    </div>
                  </div>
                )}
                
                {/* Customization Controls */}
                <div className="border-t pt-6 mt-8">
                  <h3 className="text-xl font-bold mb-4">üé® Customize Appearance</h3>
                  <div className="grid md:grid-cols-3 gap-4">
                    <div>
                      <label className="block text-sm font-medium mb-1">
                        Template
                        {resumeData.template && templates.find(t => t.name === resumeData.template)?.hasPhoto && (
                          <span className="ml-2 text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded">üì∏ Photo</span>
                        )}
                      </label>
                      <select
                        value={resumeData.template}
                        onChange={(e) => setResumeData(prev => ({ ...prev, template: e.target.value }))}
                        className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                      >
                        {templates.map(t => (
                          <option key={t.name} value={t.name}>
                            {t.name} {t.hasPhoto ? 'üì∏' : ''}
                          </option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Font Family</label>
                      <select
                        value={resumeData.font}
                        onChange={(e) => setResumeData(prev => ({ ...prev, font: e.target.value }))}
                        className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                      >
                        {fonts.map(f => (
                          <option key={f} value={f}>{f}</option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Accent Color</label>
                      <input
                        type="color"
                        value={resumeData.themeColors.accent}
                        onChange={(e) => setResumeData(prev => ({
                          ...prev,
                          themeColors: { ...prev.themeColors, accent: e.target.value }
                        }))}
                        className="w-full h-10 border rounded-lg cursor-pointer"
                      />
                    </div>
                  </div>
                  <div className="mt-4">
                    <label className="block text-sm font-medium mb-2">Color Presets</label>
                    <div className="flex flex-wrap gap-2">
                      {colorPresets.map((preset, idx) => (
                        <button
                          key={idx}
                          onClick={() => setResumeData(prev => ({ ...prev, themeColors: preset }))}
                          className="px-3 py-2 text-sm rounded-lg border hover:border-blue-500 transition"
                          style={{ backgroundColor: preset.background, color: preset.text, borderColor: preset.accent }}
                        >
                          {preset.name}
                        </button>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };
    
    // Resume Preview Component
    const ResumePreview = ({ data }) => {
      const fontClass = `font-${data.font.toLowerCase().replace(' ', '')}`;
      
      // Render different templates
      switch (data.template) {
        case 'Modern Blue':
          return <ModernBlueTemplate data={data} fontClass={fontClass} />;
        case 'Bold Dark':
          return <BoldDarkTemplate data={data} fontClass={fontClass} />;
        case 'Creative Split':
          return <CreativeSplitTemplate data={data} fontClass={fontClass} />;
        case 'Corporate Gray':
          return <CorporateGrayTemplate data={data} fontClass={fontClass} />;
        case 'Elegant Serif':
          return <ElegantSerifTemplate data={data} fontClass={fontClass} />;
        case 'Gradient Neon':
          return <GradientNeonTemplate data={data} fontClass={fontClass} />;
        case 'Monochrome Zigzag':
          return <MonochromeZigzagTemplate data={data} fontClass={fontClass} />;
        case 'Professional Photo':
          return <ProfessionalPhotoTemplate data={data} fontClass={fontClass} />;
        case 'Executive Portrait':
          return <ExecutivePortraitTemplate data={data} fontClass={fontClass} />;
        case 'Creative Profile':
          return <CreativeProfileTemplate data={data} fontClass={fontClass} />;
        case 'Modern Minimal Photo':
          return <ModernMinimalPhotoTemplate data={data} fontClass={fontClass} />;
        case 'Tech Startup':
          return <TechStartupTemplate data={data} fontClass={fontClass} />;
        default:
          return <MinimalistTemplate data={data} fontClass={fontClass} />;
      }
    };
    
    // Minimalist Template
    const MinimalistTemplate = ({ data, fontClass }) => {
      return (
        <div id="resume-preview" className={`a4-preview p-12 ${fontClass}`} style={{ color: data.themeColors.text }}>
          {/* Header */}
          <div className="text-center mb-8 pb-6 border-b-2" style={{ borderColor: data.themeColors.accent }}>
            <h1 className="text-4xl font-bold mb-2">{data.personalInfo.fullName || 'Your Name'}</h1>
            <p className="text-xl mb-4" style={{ color: data.themeColors.accent }}>
              {data.personalInfo.jobTitle || 'Your Job Title'}
            </p>
            <div className="flex justify-center flex-wrap gap-4 text-sm">
              {data.personalInfo.email && <span>{data.personalInfo.email}</span>}
              {data.personalInfo.phone && <span>‚Ä¢</span>}
              {data.personalInfo.phone && <span>{data.personalInfo.phone}</span>}
              {data.personalInfo.location && <span>‚Ä¢</span>}
              {data.personalInfo.location && <span>{data.personalInfo.location}</span>}
            </div>
            <div className="flex justify-center flex-wrap gap-4 text-sm mt-2">
              {data.personalInfo.linkedin && <span>{data.personalInfo.linkedin}</span>}
              {data.personalInfo.website && <span>‚Ä¢</span>}
              {data.personalInfo.website && <span>{data.personalInfo.website}</span>}
              {data.personalInfo.github && <span>‚Ä¢</span>}
              {data.personalInfo.github && <span>{data.personalInfo.github}</span>}
            </div>
          </div>
          
          {/* Summary */}
          {data.summary && (
            <div className="mb-6">
              <h2 className="text-lg font-bold mb-3 uppercase" style={{ color: data.themeColors.accent }}>
                Professional Summary
              </h2>
              <p className="text-sm leading-relaxed italic">{data.summary}</p>
            </div>
          )}
          
          {/* Experience */}
          {data.experience.length > 0 && (
            <div className="mb-6">
              <h2 className="text-lg font-bold mb-3 uppercase" style={{ color: data.themeColors.accent }}>
                Experience
              </h2>
              {data.experience.map((exp, idx) => (
                <div key={idx} className="mb-4">
                  <div className="flex justify-between items-start mb-1">
                    <div>
                      <h3 className="font-semibold">{exp.jobTitle}</h3>
                      <p className="text-sm">{exp.company}{exp.location && ` - ${exp.location}`}</p>
                    </div>
                    <span className="text-sm text-gray-600">
                      {exp.startDate} - {exp.endDate}
                    </span>
                  </div>
                  <p className="text-sm whitespace-pre-line mt-2">{exp.description}</p>
                </div>
              ))}
            </div>
          )}
          
          {/* Education */}
          {data.education.length > 0 && (
            <div className="mb-6">
              <h2 className="text-lg font-bold mb-3 uppercase" style={{ color: data.themeColors.accent }}>
                Education
              </h2>
              {data.education.map((edu, idx) => (
                <div key={idx} className="mb-3">
                  <div className="flex justify-between items-start">
                    <div>
                      <h3 className="font-semibold">{edu.degree}</h3>
                      <p className="text-sm">{edu.institution}</p>
                      {edu.description && <p className="text-sm text-gray-600">{edu.description}</p>}
                    </div>
                    <span className="text-sm text-gray-600">{edu.year}</span>
                  </div>
                </div>
              ))}
            </div>
          )}
          
          {/* Projects */}
          {data.projects.length > 0 && (
            <div className="mb-6">
              <h2 className="text-lg font-bold mb-3 uppercase" style={{ color: data.themeColors.accent }}>
                Projects
              </h2>
              {data.projects.map((proj, idx) => (
                <div key={idx} className="mb-3">
                  <h3 className="font-semibold">{proj.title} {proj.role && `- ${proj.role}`}</h3>
                  <p className="text-sm mt-1">{proj.description}</p>
                  {proj.technologies && (
                    <p className="text-sm text-gray-600 mt-1"><strong>Technologies:</strong> {proj.technologies}</p>
                  )}
                  {proj.link && (
                    <p className="text-sm text-gray-600">{proj.link}</p>
                  )}
                </div>
              ))}
            </div>
          )}
          
          {/* Skills */}
          {data.skills.length > 0 && (
            <div className="mb-6">
              <h2 className="text-lg font-bold mb-3 uppercase" style={{ color: data.themeColors.accent }}>
                Skills
              </h2>
              <div className="grid grid-cols-3 gap-2">
                {data.skills.map((skill, idx) => (
                  <div key={idx} className="text-sm">{skill}</div>
                ))}
              </div>
            </div>
          )}
          
          {/* Certifications */}
          {data.certifications.length > 0 && (
            <div className="mb-6">
              <h2 className="text-lg font-bold mb-3 uppercase" style={{ color: data.themeColors.accent }}>
                Certifications
              </h2>
              <ul className="text-sm space-y-1">
                {data.certifications.map((cert, idx) => (
                  <li key={idx}>‚Ä¢ {cert}</li>
                ))}
              </ul>
            </div>
          )}
          
          {/* Languages */}
          {data.languages.length > 0 && (
            <div className="mb-6">
              <h2 className="text-lg font-bold mb-3 uppercase" style={{ color: data.themeColors.accent }}>
                Languages
              </h2>
              <div className="flex flex-wrap gap-3 text-sm">
                {data.languages.map((lang, idx) => (
                  <span key={idx}>{lang}</span>
                ))}
              </div>
            </div>
          )}
          
          {/* Custom Fields */}
          {data.customFields && data.customFields.length > 0 && data.customFields.map((field, idx) => (
            <div key={field.id || idx} className="mb-6">
              <h2 className="text-lg font-bold mb-3 uppercase" style={{ color: data.themeColors.accent }}>
                {field.title}
              </h2>
              <p className="text-sm whitespace-pre-line">{field.content}</p>
            </div>
          ))}
        </div>
      );
    };
    
    // Modern Blue Template (Two-column with sidebar)
    const ModernBlueTemplate = ({ data, fontClass }) => {
      return (
        <div id="resume-preview" className={`a4-preview flex ${fontClass}`} style={{ color: data.themeColors.text }}>
          {/* Left Sidebar */}
          <div className="w-1/3 p-8" style={{ backgroundColor: data.themeColors.accent, color: '#ffffff' }}>
            <div className="mb-6">
              <h1 className="text-2xl font-bold mb-1">{data.personalInfo.fullName || 'Your Name'}</h1>
              <p className="text-sm opacity-90">{data.personalInfo.jobTitle || 'Your Job Title'}</p>
            </div>
            
            {/* Contact */}
            <div className="mb-6 text-sm">
              <h3 className="font-bold mb-2 text-xs uppercase tracking-wide">Contact</h3>
              {data.personalInfo.email && <p className="mb-1 break-words">{data.personalInfo.email}</p>}
              {data.personalInfo.phone && <p className="mb-1">{data.personalInfo.phone}</p>}
              {data.personalInfo.location && <p className="mb-1">{data.personalInfo.location}</p>}
              {data.personalInfo.linkedin && <p className="mb-1 break-words">{data.personalInfo.linkedin}</p>}
            </div>
            
            {/* Skills */}
            {data.skills.length > 0 && (
              <div className="mb-6 text-sm">
                <h3 className="font-bold mb-2 text-xs uppercase tracking-wide">Skills</h3>
                <div className="space-y-1">
                  {data.skills.map((skill, idx) => (
                    <div key={idx}>‚Ä¢ {skill}</div>
                  ))}
                </div>
              </div>
            )}
            
            {/* Languages */}
            {data.languages.length > 0 && (
              <div className="mb-6 text-sm">
                <h3 className="font-bold mb-2 text-xs uppercase tracking-wide">Languages</h3>
                <div className="space-y-1">
                  {data.languages.map((lang, idx) => (
                    <div key={idx}>{lang}</div>
                  ))}
                </div>
              </div>
            )}
            
            {/* Certifications */}
            {data.certifications.length > 0 && (
              <div className="text-sm">
                <h3 className="font-bold mb-2 text-xs uppercase tracking-wide">Certifications</h3>
                <div className="space-y-1">
                  {data.certifications.map((cert, idx) => (
                    <div key={idx} className="text-xs">‚Ä¢ {cert}</div>
                  ))}
                </div>
              </div>
            )}
          </div>
          
          {/* Right Main Content */}
          <div className="w-2/3 p-8">
            {/* Summary */}
            {data.summary && (
              <div className="mb-6">
                <h2 className="text-lg font-bold mb-2 pb-1 border-b-2" style={{ borderColor: data.themeColors.accent }}>
                  Professional Summary
                </h2>
                <p className="text-sm leading-relaxed mt-2">{data.summary}</p>
              </div>
            )}
            
            {/* Experience */}
            {data.experience.length > 0 && (
              <div className="mb-6">
                <h2 className="text-lg font-bold mb-2 pb-1 border-b-2" style={{ borderColor: data.themeColors.accent }}>
                  Experience
                </h2>
                {data.experience.map((exp, idx) => (
                  <div key={idx} className="mt-3">
                    <div className="flex justify-between items-start">
                      <div>
                        <h3 className="font-bold text-sm">{exp.jobTitle}</h3>
                        <p className="text-sm" style={{ color: data.themeColors.accent }}>{exp.company}</p>
                      </div>
                      <span className="text-xs text-gray-600">{exp.startDate} - {exp.endDate}</span>
                    </div>
                    <p className="text-xs mt-2 whitespace-pre-line">{exp.description}</p>
                  </div>
                ))}
              </div>
            )}
            
            {/* Education */}
            {data.education.length > 0 && (
              <div className="mb-6">
                <h2 className="text-lg font-bold mb-2 pb-1 border-b-2" style={{ borderColor: data.themeColors.accent }}>
                  Education
                </h2>
                {data.education.map((edu, idx) => (
                  <div key={idx} className="mt-3">
                    <h3 className="font-bold text-sm">{edu.degree}</h3>
                    <p className="text-sm">{edu.institution} - {edu.year}</p>
                    {edu.description && <p className="text-xs text-gray-600">{edu.description}</p>}
                  </div>
                ))}
              </div>
            )}
            
            {/* Projects */}
            {data.projects.length > 0 && (
              <div>
                <h2 className="text-lg font-bold mb-2 pb-1 border-b-2" style={{ borderColor: data.themeColors.accent }}>
                  Projects
                </h2>
                {data.projects.map((proj, idx) => (
                  <div key={idx} className="mt-3">
                    <h3 className="font-bold text-sm">{proj.title}</h3>
                    <p className="text-xs mt-1">{proj.description}</p>
                    {proj.technologies && (
                      <p className="text-xs text-gray-600 mt-1"><strong>Tech:</strong> {proj.technologies}</p>
                    )}
                  </div>
                ))}
              </div>
            )}
          </div>
          
          {/* Custom Fields */}
          {data.customFields && data.customFields.length > 0 && data.customFields.map((field, idx) => (
            <div key={field.id || idx}>
              <h2 className="text-lg font-bold mb-2 pb-1 border-b-2" style={{ borderColor: data.themeColors.accent }}>
                {field.title.toUpperCase()}
              </h2>
              <p className="text-xs mt-2 whitespace-pre-line">{field.content}</p>
            </div>
          ))}
        </div>
      );
    };
    
    // Bold Dark Template
    const BoldDarkTemplate = ({ data, fontClass }) => {
      return (
        <div id="resume-preview" className={`a4-preview ${fontClass}`}>
          {/* Dark Header */}
          <div className="p-8 text-white" style={{ backgroundColor: data.themeColors.accent }}>
            <h1 className="text-5xl font-bold mb-2">{data.personalInfo.fullName || 'YOUR NAME'}</h1>
            <p className="text-2xl mb-4">{data.personalInfo.jobTitle || 'Your Job Title'}</p>
            <div className="flex flex-wrap gap-4 text-sm">
              {data.personalInfo.email && <span>üìß {data.personalInfo.email}</span>}
              {data.personalInfo.phone && <span>üì± {data.personalInfo.phone}</span>}
              {data.personalInfo.location && <span>üìç {data.personalInfo.location}</span>}
            </div>
          </div>
          
          {/* Content */}
          <div className="p-8">
            {data.summary && (
              <div className="mb-6">
                <h2 className="text-xl font-bold mb-2" style={{ color: data.themeColors.accent }}>ABOUT ME</h2>
                <p className="text-sm leading-relaxed">{data.summary}</p>
              </div>
            )}
            
            {data.experience.length > 0 && (
              <div className="mb-6">
                <h2 className="text-xl font-bold mb-3" style={{ color: data.themeColors.accent }}>EXPERIENCE</h2>
                {data.experience.map((exp, idx) => (
                  <div key={idx} className="mb-4 flex gap-4">
                    <div className="text-sm text-gray-600 w-32 flex-shrink-0">
                      {exp.startDate} - {exp.endDate}
                    </div>
                    <div className="flex-1">
                      <h3 className="font-bold">{exp.jobTitle}</h3>
                      <p className="text-sm font-semibold" style={{ color: data.themeColors.accent }}>{exp.company}</p>
                      <p className="text-sm mt-1 whitespace-pre-line">{exp.description}</p>
                    </div>
                  </div>
                ))}
              </div>
            )}
            
            <div className="grid grid-cols-2 gap-6">
              {/* Education */}
              {data.education.length > 0 && (
                <div>
                  <h2 className="text-xl font-bold mb-3" style={{ color: data.themeColors.accent }}>EDUCATION</h2>
                  {data.education.map((edu, idx) => (
                    <div key={idx} className="mb-3">
                      <h3 className="font-bold text-sm">{edu.degree}</h3>
                      <p className="text-sm">{edu.institution}</p>
                      <p className="text-xs text-gray-600">{edu.year}</p>
                    </div>
                  ))}
                </div>
              )}
              
              {/* Skills */}
              {data.skills.length > 0 && (
                <div>
                  <h2 className="text-xl font-bold mb-3" style={{ color: data.themeColors.accent }}>SKILLS</h2>
                  <div className="flex flex-wrap gap-2">
                    {data.skills.map((skill, idx) => (
                      <span key={idx} className="px-3 py-1 rounded-full text-xs text-white" style={{ backgroundColor: data.themeColors.accent }}>
                        {skill}
                      </span>
                    ))}
                  </div>
                </div>
              )}
            </div>
            
            {/* Custom Fields */}
            {data.customFields && data.customFields.length > 0 && data.customFields.map((field, idx) => (
              <div key={field.id || idx} className="mb-6">
                <h2 className="text-xl font-bold mb-3" style={{ color: data.themeColors.accent }}>{field.title.toUpperCase()}</h2>
                <div className="text-sm whitespace-pre-line">{field.content}</div>
              </div>
            ))}
          </div>
        </div>
      );
    };
    
    // Creative Split Template
    const CreativeSplitTemplate = ({ data, fontClass }) => {
      return (
        <div id="resume-preview" className={`a4-preview flex ${fontClass}`}>
          {/* Left 40% */}
          <div className="w-2/5 p-6" style={{ backgroundColor: `${data.themeColors.accent}15` }}>
            <div className="mb-6">
              <div className="w-24 h-24 rounded-full mb-4 flex items-center justify-center text-4xl font-bold text-white" style={{ backgroundColor: data.themeColors.accent }}>
                {data.personalInfo.fullName ? data.personalInfo.fullName.charAt(0) : 'Y'}
              </div>
              <h2 className="text-2xl font-bold" style={{ color: data.themeColors.accent }}>Profile</h2>
              {data.summary && <p className="text-xs mt-2 leading-relaxed">{data.summary}</p>}
            </div>
            
            {data.skills.length > 0 && (
              <div className="mb-6">
                <h3 className="font-bold mb-2" style={{ color: data.themeColors.accent }}>SKILLS</h3>
                <div className="space-y-2">
                  {data.skills.slice(0, 8).map((skill, idx) => (
                    <div key={idx}>
                      <div className="text-xs mb-1">{skill}</div>
                      <div className="h-1.5 bg-gray-300 rounded">
                        <div className="h-1.5 rounded" style={{ backgroundColor: data.themeColors.accent, width: '80%' }}></div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
            
            {data.education.length > 0 && (
              <div>
                <h3 className="font-bold mb-2" style={{ color: data.themeColors.accent }}>EDUCATION</h3>
                {data.education.map((edu, idx) => (
                  <div key={idx} className="mb-3">
                    <p className="text-xs font-bold">{edu.degree}</p>
                    <p className="text-xs">{edu.institution}</p>
                    <p className="text-xs text-gray-600">{edu.year}</p>
                  </div>
                ))}
              </div>
            )}
          </div>
          
          {/* Right 60% */}
          <div className="w-3/5 p-8">
            <div className="mb-6">
              <h1 className="text-4xl font-bold">{data.personalInfo.fullName || 'Your Name'}</h1>
              <p className="text-xl" style={{ color: data.themeColors.accent }}>{data.personalInfo.jobTitle || 'Your Job Title'}</p>
              <div className="text-xs mt-2 space-y-1">
                {data.personalInfo.email && <p>{data.personalInfo.email}</p>}
                {data.personalInfo.phone && <p>{data.personalInfo.phone}</p>}
                {data.personalInfo.location && <p>{data.personalInfo.location}</p>}
              </div>
            </div>
            
            {data.experience.length > 0 && (
              <div className="mb-6">
                <h2 className="text-lg font-bold mb-3 pb-2 border-b" style={{ borderColor: data.themeColors.accent, color: data.themeColors.accent }}>
                  EXPERIENCE
                </h2>
                {data.experience.map((exp, idx) => (
                  <div key={idx} className="mb-4">
                    <h3 className="font-bold text-sm">{exp.jobTitle} @ {exp.company}</h3>
                    <p className="text-xs text-gray-600">{exp.startDate} - {exp.endDate}</p>
                    <p className="text-xs mt-1 whitespace-pre-line">{exp.description}</p>
                  </div>
                ))}
              </div>
            )}
            
            {data.projects.length > 0 && (
              <div>
                <h2 className="text-lg font-bold mb-3 pb-2 border-b" style={{ borderColor: data.themeColors.accent, color: data.themeColors.accent }}>
                  PROJECTS
                </h2>
                {data.projects.map((proj, idx) => (
                  <div key={idx} className="mb-3">
                    <h3 className="font-bold text-sm">{proj.title}</h3>
                    <p className="text-xs mt-1">{proj.description}</p>
                    {proj.technologies && (
                      <p className="text-xs text-gray-600 mt-1">{proj.technologies}</p>
                    )}
                  </div>
                ))}
              </div>
            )}
          </div>
          
          {/* Custom Fields */}
          {data.customFields && data.customFields.length > 0 && data.customFields.map((field, idx) => (
            <div key={field.id || idx} className="mb-6">
              <h2 className="text-xl font-bold mb-3 pb-2 border-b" style={{ borderColor: data.themeColors.accent, color: data.themeColors.accent }}>
                {field.title.toUpperCase()}
              </h2>
              <p className="text-xs mt-2 whitespace-pre-line">{field.content}</p>
            </div>
          ))}
        </div>
      );
    };
    
    // Corporate Gray Template
    const CorporateGrayTemplate = ({ data, fontClass }) => {
      return (
        <div id="resume-preview" className={`a4-preview p-12 ${fontClass} font-georgia`} style={{ backgroundColor: '#fafafa' }}>
          <div className="text-center mb-8 pb-6 border-b-2 border-gray-400">
            <h1 className="text-4xl font-bold mb-2" style={{ color: '#333' }}>{data.personalInfo.fullName || 'YOUR NAME'}</h1>
            <p className="text-lg text-gray-700 mb-3">{data.personalInfo.jobTitle || 'Your Job Title'}</p>
            <div className="text-sm text-gray-600 space-x-3">
              {data.personalInfo.email && <span>{data.personalInfo.email}</span>}
              {data.personalInfo.phone && <span>|</span>}
              {data.personalInfo.phone && <span>{data.personalInfo.phone}</span>}
              {data.personalInfo.location && <span>|</span>}
              {data.personalInfo.location && <span>{data.personalInfo.location}</span>}
            </div>
          </div>
          
          {data.summary && (
            <div className="mb-6">
              <h2 className="text-sm font-bold mb-2 uppercase tracking-wider text-gray-700 border-b border-gray-300 pb-1">Professional Summary</h2>
              <p className="text-sm leading-relaxed text-gray-800">{data.summary}</p>
            </div>
          )}
          
          {data.experience.length > 0 && (
            <div className="mb-6">
              <h2 className="text-sm font-bold mb-3 uppercase tracking-wider text-gray-700 border-b border-gray-300 pb-1">Professional Experience</h2>
              {data.experience.map((exp, idx) => (
                <div key={idx} className="mb-4">
                  <div className="flex justify-between items-start mb-1">
                    <h3 className="font-bold">{exp.jobTitle}</h3>
                    <span className="text-sm text-gray-600">{exp.startDate} - {exp.endDate}</span>
                  </div>
                  <p className="text-sm italic text-gray-700 mb-2">{exp.company}{exp.location && `, ${exp.location}`}</p>
                  <p className="text-sm text-gray-800 whitespace-pre-line">{exp.description}</p>
                </div>
              ))}
            </div>
          )}
          
          {data.education.length > 0 && (
            <div className="mb-6">
              <h2 className="text-sm font-bold mb-3 uppercase tracking-wider text-gray-700 border-b border-gray-300 pb-1">Education</h2>
              {data.education.map((edu, idx) => (
                <div key={idx} className="mb-2">
                  <div className="flex justify-between items-start">
                    <div>
                      <h3 className="font-bold text-sm">{edu.degree}</h3>
                      <p className="text-sm text-gray-700">{edu.institution}</p>
                    </div>
                    <span className="text-sm text-gray-600">{edu.year}</span>
                  </div>
                </div>
              ))}
            </div>
          )}
          
          {data.skills.length > 0 && (
            <div className="mb-6">
              <h2 className="text-sm font-bold mb-2 uppercase tracking-wider text-gray-700 border-b border-gray-300 pb-1">Core Competencies</h2>
              <p className="text-sm text-gray-800">{data.skills.join(' ‚Ä¢ ')}</p>
            </div>
          )}
          
          {/* Custom Fields */}
          {data.customFields && data.customFields.length > 0 && data.customFields.map((field, idx) => (
            <div key={field.id || idx} className="mb-6">
              <h2 className="text-sm font-bold mb-2 uppercase tracking-wider text-gray-700 border-b border-gray-300 pb-1">{field.title}</h2>
              <p className="text-sm text-gray-800 whitespace-pre-line">{field.content}</p>
            </div>
          ))}
        </div>
      );
    };
    
    // Gradient Neon Template - Vibrant startup energy with multi-color gradient
    const GradientNeonTemplate = ({ data, fontClass }) => {
      return (
        <div id="resume-preview" className={`a4-preview font-quicksand`} style={{ backgroundColor: '#18181b' }}>
          {/* Gradient Header */}
          <div className="p-8 text-white relative overflow-hidden" style={{ background: 'linear-gradient(90deg, #a726ff 0%, #f72585 25%, #ffba08 50%, #43e97b 75%, #4cc9f0 100%)' }}>
            <div className="relative z-10">
              <h1 className="text-5xl font-black mb-2 tracking-tight">{data.personalInfo.fullName || 'YOUR NAME'}</h1>
              <p className="text-2xl font-semibold mb-4 opacity-95">{data.personalInfo.jobTitle || 'Your Job Title'}</p>
              <div className="flex flex-wrap gap-4 text-sm">
                {data.personalInfo.email && <span className="flex items-center gap-1">‚úâ {data.personalInfo.email}</span>}
                {data.personalInfo.phone && <span className="flex items-center gap-1">üì± {data.personalInfo.phone}</span>}
                {data.personalInfo.location && <span className="flex items-center gap-1">üìç {data.personalInfo.location}</span>}
              </div>
              <div className="flex flex-wrap gap-3 text-sm mt-2">
                {data.personalInfo.linkedin && <span className="bg-white bg-opacity-20 px-3 py-1 rounded-full">üîó LinkedIn</span>}
                {data.personalInfo.github && <span className="bg-white bg-opacity-20 px-3 py-1 rounded-full">üíª GitHub</span>}
                {data.personalInfo.website && <span className="bg-white bg-opacity-20 px-3 py-1 rounded-full">üåê Website</span>}
              </div>
            </div>
            {/* Decorative shapes */}
            <div className="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -mr-16 -mt-16"></div>
            <div className="absolute bottom-0 left-0 w-24 h-24 bg-white opacity-10 rounded-full -ml-12 -mb-12"></div>
          </div>
          
          {/* Main Content */}
          <div className="p-8 text-gray-100">
            {/* Summary with gradient accent */}
            {data.summary && (
              <div className="mb-6">
                <div className="flex items-center gap-3 mb-3">
                  <div className="w-2 h-8 rounded-full" style={{ background: 'linear-gradient(180deg, #a726ff, #f72585)' }}></div>
                  <h2 className="text-2xl font-bold text-white">Profile</h2>
                </div>
                <p className="text-sm leading-relaxed ml-5">{data.summary}</p>
              </div>
            )}
            
            {/* Experience with angular blocks */}
            {data.experience.length > 0 && (
              <div className="mb-6">
                <div className="flex items-center gap-3 mb-3">
                  <div className="w-2 h-8 rounded-full" style={{ background: 'linear-gradient(180deg, #f72585, #ffba08)' }}></div>
                  <h2 className="text-2xl font-bold text-white">Experience</h2>
                </div>
                {data.experience.map((exp, idx) => (
                  <div key={idx} className="ml-5 mb-4 relative">
                    <div className="absolute left-0 top-0 w-1 h-full bg-gradient-to-b from-purple-500 to-pink-500 opacity-30"></div>
                    <div className="pl-4">
                      <div className="flex justify-between items-start mb-1">
                        <div>
                          <h3 className="font-bold text-white">{exp.jobTitle}</h3>
                          <p className="text-sm" style={{ color: '#43e97b' }}>{exp.company}</p>
                        </div>
                        <span className="text-xs bg-gray-800 px-2 py-1 rounded">{exp.startDate} - {exp.endDate}</span>
                      </div>
                      <p className="text-sm mt-2 whitespace-pre-line">{exp.description}</p>
                    </div>
                  </div>
                ))}
              </div>
            )}
            
            <div className="grid grid-cols-2 gap-6">
              {/* Education */}
              {data.education.length > 0 && (
                <div>
                  <div className="flex items-center gap-3 mb-3">
                    <div className="w-2 h-8 rounded-full" style={{ background: 'linear-gradient(180deg, #ffba08, #43e97b)' }}></div>
                    <h2 className="text-xl font-bold text-white">Education</h2>
                  </div>
                  {data.education.map((edu, idx) => (
                    <div key={idx} className="ml-5 mb-3">
                      <h3 className="font-bold text-sm text-white">{edu.degree}</h3>
                      <p className="text-xs">{edu.institution}</p>
                      <p className="text-xs opacity-70">{edu.year}</p>
                    </div>
                  ))}
                </div>
              )}
              
              {/* Projects */}
              {data.projects.length > 0 && (
                <div>
                  <div className="flex items-center gap-3 mb-3">
                    <div className="w-2 h-8 rounded-full" style={{ background: 'linear-gradient(180deg, #43e97b, #4cc9f0)' }}></div>
                    <h2 className="text-xl font-bold text-white">Projects</h2>
                  </div>
                  {data.projects.map((proj, idx) => (
                    <div key={idx} className="ml-5 mb-3">
                      <h3 className="font-bold text-sm text-white">{proj.title}</h3>
                      <p className="text-xs mt-1">{proj.description}</p>
                    </div>
                  ))}
                </div>
              )}
            </div>
            
            {/* Skills as colorful tags */}
            {data.skills.length > 0 && (
              <div className="mt-6">
                <div className="flex items-center gap-3 mb-3">
                  <div className="w-2 h-8 rounded-full" style={{ background: 'linear-gradient(180deg, #4cc9f0, #a726ff)' }}></div>
                  <h2 className="text-xl font-bold text-white">Skills</h2>
                </div>
                <div className="flex flex-wrap gap-2 ml-5">
                  {data.skills.map((skill, idx) => {
                    const colors = ['#a726ff', '#f72585', '#ffba08', '#43e97b', '#4cc9f0'];
                    const color = colors[idx % colors.length];
                    return (
                      <span key={idx} className="px-3 py-1 rounded-lg text-xs font-semibold text-white" style={{ backgroundColor: color + '40', borderLeft: `3px solid ${color}` }}>
                        {skill}
                      </span>
                    );
                  })}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };
    
    // Monochrome Zigzag Template - Bold minimalist with diagonal split
    const MonochromeZigzagTemplate = ({ data, fontClass }) => {
      return (
        <div id="resume-preview" className={`a4-preview font-montserrat relative overflow-hidden`} style={{ backgroundColor: '#fafafa' }}>
          {/* Zigzag diagonal header */}
          <div className="relative h-48 overflow-hidden">
            <div className="absolute inset-0" style={{ 
              background: '#111827',
              clipPath: 'polygon(0 0, 100% 0, 100% 60%, 0 80%)'
            }}>
              <div className="p-8 text-white">
                <h1 className="text-5xl font-black mb-2 tracking-tighter uppercase" style={{ letterSpacing: '-0.05em' }}>
                  {data.personalInfo.fullName || 'YOUR NAME'}
                </h1>
                <p className="text-xl font-light tracking-wide">{data.personalInfo.jobTitle || 'Your Job Title'}</p>
              </div>
            </div>
            {/* Contact info on the white area */}
            <div className="absolute bottom-4 right-8 text-right text-sm text-gray-800">
              {data.personalInfo.email && <div>{data.personalInfo.email}</div>}
              {data.personalInfo.phone && <div>{data.personalInfo.phone}</div>}
              {data.personalInfo.location && <div>{data.personalInfo.location}</div>}
            </div>
          </div>
          
          {/* Main content */}
          <div className="px-8 py-6">
            {/* Summary */}
            {data.summary && (
              <div className="mb-6">
                <div className="flex items-center gap-2 mb-2">
                  <div className="w-12 h-0.5 bg-black"></div>
                  <h2 className="text-lg font-black uppercase tracking-wide">Summary</h2>
                </div>
                <p className="text-sm leading-relaxed pl-14">{data.summary}</p>
              </div>
            )}
            
            {/* Experience with timeline */}
            {data.experience.length > 0 && (
              <div className="mb-6">
                <div className="flex items-center gap-2 mb-3">
                  <div className="w-12 h-0.5 bg-black"></div>
                  <h2 className="text-lg font-black uppercase tracking-wide">Experience</h2>
                </div>
                <div className="pl-14 space-y-4 relative">
                  {/* Timeline line */}
                  <div className="absolute left-6 top-0 bottom-0 w-px bg-black"></div>
                  {data.experience.map((exp, idx) => (
                    <div key={idx} className="relative">
                      {/* Timeline dot */}
                      <div className="absolute -left-8 top-1 w-3 h-3 bg-black rounded-full"></div>
                      <div className="bg-white p-4 shadow-sm border-l-4 border-black">
                        <div className="flex justify-between items-start mb-1">
                          <div>
                            <h3 className="font-black text-sm uppercase">{exp.jobTitle}</h3>
                            <p className="text-sm font-semibold">{exp.company}</p>
                          </div>
                          <span className="text-xs bg-black text-white px-2 py-1">{exp.startDate} - {exp.endDate}</span>
                        </div>
                        <p className="text-xs mt-2 whitespace-pre-line text-gray-700">{exp.description}</p>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
            
            <div className="grid grid-cols-2 gap-6">
              {/* Education */}
              {data.education.length > 0 && (
                <div>
                  <div className="flex items-center gap-2 mb-2">
                    <div className="w-8 h-0.5 bg-black"></div>
                    <h2 className="text-lg font-black uppercase tracking-wide">Education</h2>
                  </div>
                  <div className="pl-10 space-y-2">
                    {data.education.map((edu, idx) => (
                      <div key={idx} className="border-l-2 border-gray-300 pl-3">
                        <h3 className="font-bold text-sm">{edu.degree}</h3>
                        <p className="text-xs">{edu.institution}</p>
                        <p className="text-xs text-gray-600">{edu.year}</p>
                      </div>
                    ))}
                  </div>
                </div>
              )}
              
              {/* Skills */}
              {data.skills.length > 0 && (
                <div>
                  <div className="flex items-center gap-2 mb-2">
                    <div className="w-8 h-0.5 bg-black"></div>
                    <h2 className="text-lg font-black uppercase tracking-wide">Skills</h2>
                  </div>
                  <div className="pl-10 flex flex-wrap gap-2">
                    {data.skills.map((skill, idx) => (
                      <span key={idx} className="text-xs px-2 py-1 bg-black text-white font-semibold uppercase tracking-wide">
                        {skill}
                      </span>
                    ))}
                  </div>
                </div>
              )}
            </div>
            
            {/* Projects */}
            {data.projects.length > 0 && (
              <div className="mt-6">
                <div className="flex items-center gap-2 mb-2">
                  <div className="w-12 h-0.5 bg-black"></div>
                  <h2 className="text-lg font-black uppercase tracking-wide">Projects</h2>
                </div>
                <div className="pl-14 space-y-3">
                  {data.projects.map((proj, idx) => (
                    <div key={idx} className="border-t border-gray-300 pt-2">
                      <h3 className="font-bold text-sm">{proj.title}</h3>
                      <p className="text-xs mt-1">{proj.description}</p>
                      {proj.technologies && (
                        <p className="text-xs text-gray-600 mt-1">Tech: {proj.technologies}</p>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
          
          {/* Custom Fields */}
          {data.customFields && data.customFields.length > 0 && data.customFields.map((field, idx) => (
            <div key={field.id || idx} className="mt-6">
              <div className="flex items-center gap-2 mb-2">
                <div className="w-12 h-0.5 bg-black"></div>
                <h2 className="text-lg font-black uppercase tracking-wide">{field.title}</h2>
              </div>
              <div className="pl-14 text-xs whitespace-pre-line text-gray-700">{field.content}</div>
            </div>
          ))}
        </div>
      );
    };
    
    // Professional Photo Template - Two-column with circular photo in sidebar
    const ProfessionalPhotoTemplate = ({ data, fontClass }) => {
      const photoUrl = data.personalInfo.photoUrl;
      return (
        <div id="resume-preview" className={`a4-preview flex ${fontClass}`} style={{ color: data.themeColors.text }}>
          {/* Left Sidebar - 35% */}
          <div className="w-2/5 p-6" style={{ backgroundColor: `${data.themeColors.accent}20` }}>
            {/* Profile Photo */}
            <div className="mb-6 flex justify-center">
              {photoUrl ? (
                <img src={photoUrl} alt="Profile" className="w-36 h-36 rounded-full object-cover border-4 border-white shadow-lg" />
              ) : (
                <div className="w-36 h-36 rounded-full flex items-center justify-center text-6xl" style={{ backgroundColor: data.themeColors.accent, color: 'white' }}>
                  {data.personalInfo.fullName ? data.personalInfo.fullName.charAt(0) : 'üë§'}
                </div>
              )}
            </div>
            
            {/* Contact */}
            <div className="mb-6">
              <h3 className="font-bold mb-3 pb-2 border-b-2" style={{ borderColor: data.themeColors.accent, color: data.themeColors.accent }}>CONTACT</h3>
              <div className="text-xs space-y-2">
                {data.personalInfo.email && <p className="break-words">üìß {data.personalInfo.email}</p>}
                {data.personalInfo.phone && <p>üì± {data.personalInfo.phone}</p>}
                {data.personalInfo.location && <p>üìç {data.personalInfo.location}</p>}
                {data.personalInfo.linkedin && <p className="break-words">üîó {data.personalInfo.linkedin}</p>}
                {data.personalInfo.website && <p className="break-words">üåê {data.personalInfo.website}</p>}
                {data.personalInfo.github && <p className="break-words">üíª {data.personalInfo.github}</p>}
              </div>
            </div>
            
            {/* Skills with progress bars */}
            {data.skills.length > 0 && (
              <div className="mb-6">
                <h3 className="font-bold mb-3 pb-2 border-b-2" style={{ borderColor: data.themeColors.accent, color: data.themeColors.accent }}>SKILLS</h3>
                <div className="space-y-3">
                  {data.skills.map((skill, idx) => (
                    <div key={idx}>
                      <div className="text-xs mb-1 font-medium">{skill}</div>
                      <div className="h-2 bg-gray-300 rounded-full overflow-hidden">
                        <div className="h-2 rounded-full" style={{ backgroundColor: data.themeColors.accent, width: `${85 + (idx % 3) * 5}%` }}></div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
            
            {/* Languages */}
            {data.languages.length > 0 && (
              <div className="mb-6">
                <h3 className="font-bold mb-3 pb-2 border-b-2" style={{ borderColor: data.themeColors.accent, color: data.themeColors.accent }}>LANGUAGES</h3>
                <div className="text-xs space-y-1">
                  {data.languages.map((lang, idx) => (
                    <p key={idx}>{lang}</p>
                  ))}
                </div>
              </div>
            )}
            
            {/* Certifications */}
            {data.certifications.length > 0 && (
              <div>
                <h3 className="font-bold mb-3 pb-2 border-b-2" style={{ borderColor: data.themeColors.accent, color: data.themeColors.accent }}>CERTIFICATIONS</h3>
                <div className="text-xs space-y-1">
                  {data.certifications.map((cert, idx) => (
                    <p key={idx}>‚Ä¢ {cert}</p>
                  ))}
                </div>
              </div>
            )}
          </div>
          
          {/* Right Main Content - 65% */}
          <div className="w-3/5 p-8">
            <div className="mb-6">
              <h1 className="text-4xl font-bold mb-2" style={{ color: data.themeColors.accent }}>{data.personalInfo.fullName || 'Your Name'}</h1>
              <p className="text-xl text-gray-600">{data.personalInfo.jobTitle || 'Your Job Title'}</p>
            </div>
            
            {/* Professional Summary */}
            {data.summary && (
              <div className="mb-6">
                <h2 className="text-lg font-bold mb-2 pb-1 border-b-2" style={{ borderColor: data.themeColors.accent }}>PROFESSIONAL SUMMARY</h2>
                <p className="text-sm leading-relaxed mt-2">{data.summary}</p>
              </div>
            )}
            
            {/* Experience */}
            {data.experience.length > 0 && (
              <div className="mb-6">
                <h2 className="text-lg font-bold mb-2 pb-1 border-b-2" style={{ borderColor: data.themeColors.accent }}>EXPERIENCE</h2>
                {data.experience.map((exp, idx) => (
                  <div key={idx} className="mt-3 relative pl-4 border-l-2" style={{ borderColor: data.themeColors.accent }}>
                    <div className="flex justify-between items-start mb-1">
                      <div>
                        <h3 className="font-bold text-sm">{exp.jobTitle}</h3>
                        <p className="text-sm" style={{ color: data.themeColors.accent }}>{exp.company}</p>
                      </div>
                      <span className="text-xs text-gray-600">{exp.startDate} - {exp.endDate}</span>
                    </div>
                    <p className="text-xs mt-1 whitespace-pre-line">{exp.description}</p>
                  </div>
                ))}
              </div>
            )}
            
            {/* Education */}
            {data.education.length > 0 && (
              <div className="mb-6">
                <h2 className="text-lg font-bold mb-2 pb-1 border-b-2" style={{ borderColor: data.themeColors.accent }}>EDUCATION</h2>
                {data.education.map((edu, idx) => (
                  <div key={idx} className="mt-3">
                    <h3 className="font-bold text-sm">{edu.degree}</h3>
                    <p className="text-sm">{edu.institution} - {edu.year}</p>
                    {edu.description && <p className="text-xs text-gray-600">{edu.description}</p>}
                  </div>
                ))}
              </div>
            )}
            
            {/* Projects */}
            {data.projects.length > 0 && (
              <div>
                <h2 className="text-lg font-bold mb-2 pb-1 border-b-2" style={{ borderColor: data.themeColors.accent }}>PROJECTS</h2>
                {data.projects.map((proj, idx) => (
                  <div key={idx} className="mt-3">
                    <h3 className="font-bold text-sm">{proj.title}</h3>
                    <p className="text-xs mt-1">{proj.description}</p>
                    {proj.technologies && (
                      <p className="text-xs text-gray-600 mt-1"><strong>Tech:</strong> {proj.technologies}</p>
                    )}
                  </div>
                ))}
              </div>
            )}
          </div>
          
          {/* Custom Fields */}
          {data.customFields && data.customFields.length > 0 && data.customFields.map((field, idx) => (
            <div key={field.id || idx}>
              <h2 className="text-lg font-bold mb-2 pb-1 border-b-2" style={{ borderColor: data.themeColors.accent }}>{field.title.toUpperCase()}</h2>
              <p className="text-xs mt-2 whitespace-pre-line">{field.content}</p>
            </div>
          ))}
        </div>
      );
    };
    
    // Executive Portrait Template - Header with photo left, info right
    const ExecutivePortraitTemplate = ({ data, fontClass }) => {
      const photoUrl = data.personalInfo.photoUrl;
      return (
        <div id="resume-preview" className={`a4-preview ${fontClass}`}>
          {/* Header Section */}
          <div className="p-8 flex items-start gap-6" style={{ backgroundColor: '#2d3748', color: 'white' }}>
            {/* Photo */}
            <div className="flex-shrink-0">
              {photoUrl ? (
                <img src={photoUrl} alt="Profile" className="w-32 h-32 rounded-full object-cover border-4 border-white shadow-xl" />
              ) : (
                <div className="w-32 h-32 rounded-full flex items-center justify-center text-5xl bg-gray-600 border-4 border-white">
                  {data.personalInfo.fullName ? data.personalInfo.fullName.charAt(0) : 'üë§'}
                </div>
              )}
            </div>
            
            {/* Name and Contact */}
            <div className="flex-1">
              <h1 className="text-4xl font-bold mb-2">{data.personalInfo.fullName || 'Your Name'}</h1>
              <p className="text-xl mb-3 opacity-90">{data.personalInfo.jobTitle || 'Your Job Title'}</p>
              <div className="grid grid-cols-2 gap-2 text-sm">
                {data.personalInfo.email && <p>üìß {data.personalInfo.email}</p>}
                {data.personalInfo.phone && <p>üì± {data.personalInfo.phone}</p>}
                {data.personalInfo.location && <p>üìç {data.personalInfo.location}</p>}
                {data.personalInfo.linkedin && <p>üîó LinkedIn</p>}
              </div>
            </div>
          </div>
          
          {/* Professional Summary */}
          {data.summary && (
            <div className="px-8 py-6 bg-gray-100">
              <p className="text-sm leading-relaxed text-gray-800">{data.summary}</p>
            </div>
          )}
          
          {/* Main Content */}
          <div className="p-8">
            {/* Experience */}
            {data.experience.length > 0 && (
              <div className="mb-6">
                <h2 className="text-2xl font-bold mb-4" style={{ color: data.themeColors.accent }}>EXPERIENCE</h2>
                {data.experience.map((exp, idx) => (
                  <div key={idx} className="mb-5">
                    <div className="flex justify-between items-start mb-2">
                      <div>
                        <h3 className="text-lg font-bold">{exp.jobTitle}</h3>
                        <p className="font-semibold" style={{ color: data.themeColors.accent }}>{exp.company}</p>
                      </div>
                      <span className="text-sm text-gray-600">{exp.startDate} - {exp.endDate}</span>
                    </div>
                    <p className="text-sm whitespace-pre-line">{exp.description}</p>
                  </div>
                ))}
              </div>
            )}
            
            <div className="grid grid-cols-2 gap-6">
              {/* Education */}
              {data.education.length > 0 && (
                <div>
                  <h2 className="text-xl font-bold mb-3" style={{ color: data.themeColors.accent }}>EDUCATION</h2>
                  {data.education.map((edu, idx) => (
                    <div key={idx} className="mb-3">
                      <h3 className="font-bold text-sm">{edu.degree}</h3>
                      <p className="text-sm">{edu.institution}</p>
                      <p className="text-xs text-gray-600">{edu.year}</p>
                    </div>
                  ))}
                </div>
              )}
              
              {/* Skills */}
              {data.skills.length > 0 && (
                <div>
                  <h2 className="text-xl font-bold mb-3" style={{ color: data.themeColors.accent }}>SKILLS</h2>
                  <div className="grid grid-cols-2 gap-2 text-sm">
                    {data.skills.map((skill, idx) => (
                      <div key={idx}>‚Ä¢ {skill}</div>
                    ))}
                  </div>
                </div>
              )}
            </div>
            
            {/* Certifications */}
            {data.certifications.length > 0 && (
              <div className="mt-6">
                <h2 className="text-xl font-bold mb-3" style={{ color: data.themeColors.accent }}>CERTIFICATIONS</h2>
                <div className="grid grid-cols-2 gap-2 text-sm">
                  {data.certifications.map((cert, idx) => (
                    <div key={idx}>‚úì {cert}</div>
                  ))}
                </div>
              </div>
            )}
          </div>
          
          {/* Custom Fields */}
          {data.customFields && data.customFields.length > 0 && data.customFields.map((field, idx) => (
            <div key={field.id || idx} className="mt-6">
              <h2 className="text-xl font-bold mb-3" style={{ color: data.themeColors.accent }}>{field.title.toUpperCase()}</h2>
              <div className="text-sm whitespace-pre-line">{field.content}</div>
            </div>
          ))}
        </div>
      );
    };
    
    // Creative Profile Template - Gradient sidebar with photo
    const CreativeProfileTemplate = ({ data, fontClass }) => {
      const photoUrl = data.personalInfo.photoUrl;
      return (
        <div id="resume-preview" className={`a4-preview flex ${fontClass}`}>
          {/* Left Sidebar - 40% with gradient */}
          <div className="w-2/5 p-6 text-white" style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)' }}>
            {/* Profile Photo */}
            <div className="mb-6">
              {photoUrl ? (
                <img src={photoUrl} alt="Profile" className="w-44 h-44 rounded-2xl object-cover border-4 border-white shadow-2xl" />
              ) : (
                <div className="w-44 h-44 rounded-2xl flex items-center justify-center text-7xl bg-white bg-opacity-20 border-4 border-white">
                  {data.personalInfo.fullName ? data.personalInfo.fullName.charAt(0) : 'üë§'}
                </div>
              )}
            </div>
            
            <h1 className="text-3xl font-bold mb-2">{data.personalInfo.fullName || 'Your Name'}</h1>
            <p className="text-lg mb-6 opacity-90">{data.personalInfo.jobTitle || 'Your Job Title'}</p>
            
            {/* Contact with icons */}
            <div className="mb-6 space-y-2 text-sm">
              {data.personalInfo.email && <p className="flex items-center gap-2 break-words">‚úâ {data.personalInfo.email}</p>}
              {data.personalInfo.phone && <p className="flex items-center gap-2">üì± {data.personalInfo.phone}</p>}
              {data.personalInfo.location && <p className="flex items-center gap-2">üìç {data.personalInfo.location}</p>}
              {data.personalInfo.linkedin && <p className="flex items-center gap-2">üîó {data.personalInfo.linkedin}</p>}
            </div>
            
            {/* Skills with rating dots */}
            {data.skills.length > 0 && (
              <div className="mb-6">
                <h3 className="font-bold text-lg mb-3 pb-2 border-b border-white border-opacity-30">SKILLS</h3>
                <div className="space-y-2 text-sm">
                  {data.skills.map((skill, idx) => (
                    <div key={idx} className="flex justify-between items-center">
                      <span>{skill}</span>
                      <div className="flex gap-1">
                        {[1,2,3,4,5].map(dot => (
                          <div key={dot} className="w-2 h-2 rounded-full bg-white" style={{ opacity: dot <= 4 ? 1 : 0.3 }}></div>
                        ))}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}
            
            {/* Languages */}
            {data.languages.length > 0 && (
              <div className="mb-6">
                <h3 className="font-bold text-lg mb-3 pb-2 border-b border-white border-opacity-30">LANGUAGES</h3>
                <div className="text-sm space-y-1">
                  {data.languages.map((lang, idx) => (
                    <p key={idx}>{lang}</p>
                  ))}
                </div>
              </div>
            )}
            
            {/* Interests */}
            {data.interests && data.interests.length > 0 && (
              <div>
                <h3 className="font-bold text-lg mb-3 pb-2 border-b border-white border-opacity-30">INTERESTS</h3>
                <div className="text-sm space-y-1">
                  {data.interests.map((interest, idx) => (
                    <p key={idx}>‚Ä¢ {interest}</p>
                  ))}
                </div>
              </div>
            )}
          </div>
          
          {/* Right Content - 60% */}
          <div className="w-3/5 p-8">
            {/* Summary */}
            {data.summary && (
              <div className="mb-6">
                <h2 className="text-2xl font-bold mb-3" style={{ color: '#667eea' }}>ABOUT ME</h2>
                <p className="text-sm leading-relaxed">{data.summary}</p>
              </div>
            )}
            
            {/* Experience */}
            {data.experience.length > 0 && (
              <div className="mb-6">
                <h2 className="text-2xl font-bold mb-3" style={{ color: '#667eea' }}>EXPERIENCE</h2>
                {data.experience.map((exp, idx) => (
                  <div key={idx} className="mb-4">
                    <div className="flex justify-between items-start mb-1">
                      <div>
                        <h3 className="font-bold">{exp.jobTitle}</h3>
                        <p className="text-sm" style={{ color: '#764ba2' }}>{exp.company}</p>
                      </div>
                      <span className="text-xs text-gray-600">{exp.startDate} - {exp.endDate}</span>
                    </div>
                    <p className="text-sm mt-1 whitespace-pre-line">{exp.description}</p>
                  </div>
                ))}
              </div>
            )}
            
            {/* Projects with links */}
            {data.projects.length > 0 && (
              <div className="mb-6">
                <h2 className="text-2xl font-bold mb-3" style={{ color: '#667eea' }}>PROJECTS</h2>
                {data.projects.map((proj, idx) => (
                  <div key={idx} className="mb-4">
                    <h3 className="font-bold">{proj.title} {proj.role && `- ${proj.role}`}</h3>
                    <p className="text-sm mt-1">{proj.description}</p>
                    {proj.technologies && (
                      <p className="text-xs text-gray-600 mt-1"><strong>Technologies:</strong> {proj.technologies}</p>
                    )}
                    {proj.link && (
                      <p className="text-xs mt-1" style={{ color: '#667eea' }}>üîó {proj.link}</p>
                    )}
                  </div>
                ))}
              </div>
            )}
            
            {/* Education */}
            {data.education.length > 0 && (
              <div>
                <h2 className="text-2xl font-bold mb-3" style={{ color: '#667eea' }}>EDUCATION</h2>
                {data.education.map((edu, idx) => (
                  <div key={idx} className="mb-3">
                    <h3 className="font-bold text-sm">{edu.degree}</h3>
                    <p className="text-sm">{edu.institution} - {edu.year}</p>
                    {edu.description && <p className="text-xs text-gray-600">{edu.description}</p>}
                  </div>
                ))}
              </div>
            )}
          </div>
          
          {/* Custom Fields */}
          {data.customFields && data.customFields.length > 0 && data.customFields.map((field, idx) => (
            <div key={field.id || idx} className="mb-6">
              <h2 className="text-2xl font-bold mb-3" style={{ color: '#667eea' }}>{field.title.toUpperCase()}</h2>
              <p className="text-sm whitespace-pre-line">{field.content}</p>
            </div>
          ))}
        </div>
      );
    };
    
    // Modern Minimal Photo Template - Centered layout
    const ModernMinimalPhotoTemplate = ({ data, fontClass }) => {
      const photoUrl = data.personalInfo.photoUrl;
      return (
        <div id="resume-preview" className={`a4-preview p-8 ${fontClass}`}>
          {/* Centered Header with Photo */}
          <div className="text-center mb-8">
            {/* Photo */}
            <div className="mb-4 flex justify-center">
              {photoUrl ? (
                <img src={photoUrl} alt="Profile" className="w-28 h-28 rounded-full object-cover border-4 shadow-lg" style={{ borderColor: data.themeColors.accent }} />
              ) : (
                <div className="w-28 h-28 rounded-full flex items-center justify-center text-5xl text-white shadow-lg" style={{ backgroundColor: data.themeColors.accent }}>
                  {data.personalInfo.fullName ? data.personalInfo.fullName.charAt(0) : 'üë§'}
                </div>
              )}
            </div>
            
            <h1 className="text-4xl font-bold mb-2">{data.personalInfo.fullName || 'Your Name'}</h1>
            <p className="text-xl mb-4" style={{ color: data.themeColors.accent }}>{data.personalInfo.jobTitle || 'Your Job Title'}</p>
            
            {/* Contact in horizontal line */}
            <div className="flex justify-center flex-wrap gap-4 text-sm text-gray-600">
              {data.personalInfo.email && <span>{data.personalInfo.email}</span>}
              {data.personalInfo.phone && <span>‚Ä¢</span>}
              {data.personalInfo.phone && <span>{data.personalInfo.phone}</span>}
              {data.personalInfo.location && <span>‚Ä¢</span>}
              {data.personalInfo.location && <span>{data.personalInfo.location}</span>}
            </div>
            <div className="flex justify-center flex-wrap gap-3 text-sm mt-2">
              {data.personalInfo.linkedin && <span style={{ color: data.themeColors.accent }}>üîó LinkedIn</span>}
              {data.personalInfo.website && <span style={{ color: data.themeColors.accent }}>üåê Website</span>}
              {data.personalInfo.github && <span style={{ color: data.themeColors.accent }}>üíª GitHub</span>}
            </div>
          </div>
          
          {/* Professional Summary */}
          {data.summary && (
            <div className="mb-6 max-w-3xl mx-auto">
              <h2 className="text-lg font-bold mb-2 text-center" style={{ color: data.themeColors.accent }}>PROFESSIONAL SUMMARY</h2>
              <p className="text-sm leading-relaxed text-center">{data.summary}</p>
            </div>
          )}
          
          {/* Experience */}
          {data.experience.length > 0 && (
            <div className="mb-6 max-w-4xl mx-auto">
              <h2 className="text-lg font-bold mb-4 pb-2 border-b-2 text-center" style={{ borderColor: data.themeColors.accent, color: data.themeColors.accent }}>EXPERIENCE</h2>
              {data.experience.map((exp, idx) => (
                <div key={idx} className="mb-4">
                  <div className="flex justify-between items-start mb-1">
                    <div>
                      <h3 className="font-bold">{exp.jobTitle}</h3>
                      <p className="text-sm" style={{ color: data.themeColors.accent }}>{exp.company}</p>
                    </div>
                    <span className="text-sm text-gray-600">{exp.startDate} - {exp.endDate}</span>
                  </div>
                  <p className="text-sm mt-1 whitespace-pre-line">{exp.description}</p>
                </div>
              ))}
            </div>
          )}
          
          {/* Skills in tag/pill format */}
          {data.skills.length > 0 && (
            <div className="mb-6 max-w-4xl mx-auto">
              <h2 className="text-lg font-bold mb-3 pb-2 border-b-2 text-center" style={{ borderColor: data.themeColors.accent, color: data.themeColors.accent }}>SKILLS</h2>
              <div className="flex flex-wrap justify-center gap-2">
                {data.skills.map((skill, idx) => (
                  <span key={idx} className="px-4 py-2 rounded-full text-sm font-medium" style={{ backgroundColor: `${data.themeColors.accent}20`, color: data.themeColors.accent }}>
                    {skill}
                  </span>
                ))}
              </div>
            </div>
          )}
          
          <div className="grid grid-cols-2 gap-6 max-w-4xl mx-auto">
            {/* Education */}
            {data.education.length > 0 && (
              <div>
                <h2 className="text-lg font-bold mb-3 pb-2 border-b-2" style={{ borderColor: data.themeColors.accent, color: data.themeColors.accent }}>EDUCATION</h2>
                {data.education.map((edu, idx) => (
                  <div key={idx} className="mb-3">
                    <h3 className="font-bold text-sm">{edu.degree}</h3>
                    <p className="text-sm">{edu.institution}</p>
                    <p className="text-xs text-gray-600">{edu.year}</p>
                  </div>
                ))}
              </div>
            )}
            
            {/* Projects */}
            {data.projects.length > 0 && (
              <div>
                <h2 className="text-lg font-bold mb-3 pb-2 border-b-2" style={{ borderColor: data.themeColors.accent, color: data.themeColors.accent }}>PROJECTS</h2>
                {data.projects.map((proj, idx) => (
                  <div key={idx} className="mb-3">
                    <h3 className="font-bold text-sm">{proj.title}</h3>
                    <p className="text-xs mt-1">{proj.description}</p>
                  </div>
                ))}
              </div>
            )}
          </div>
          
          {/* Custom Fields */}
          {data.customFields && data.customFields.length > 0 && data.customFields.map((field, idx) => (
            <div key={field.id || idx} className="grid grid-cols-2 gap-6 max-w-4xl mx-auto mt-6">
              <div className="col-span-2">
                <h2 className="text-lg font-bold mb-3 pb-2 border-b-2 text-center" style={{ borderColor: data.themeColors.accent, color: data.themeColors.accent }}>{field.title.toUpperCase()}</h2>
                <p className="text-sm whitespace-pre-line">{field.content}</p>
              </div>
            </div>
          ))}
        </div>
      );
    };
    
    // Tech Startup Template - Bold tech-focused with square photo
    const TechStartupTemplate = ({ data, fontClass }) => {
      const photoUrl = data.personalInfo.photoUrl;
      return (
        <div id="resume-preview" className={`a4-preview ${fontClass}`} style={{ backgroundColor: '#0f172a', color: '#e2e8f0' }}>
          {/* Header */}
          <div className="p-8 flex items-center gap-6" style={{ backgroundColor: '#1e293b' }}>
            {/* Square Photo with rounded corners */}
            <div className="flex-shrink-0">
              {photoUrl ? (
                <img src={photoUrl} alt="Profile" className="w-36 h-36 rounded-xl object-cover border-4 shadow-2xl" style={{ borderColor: '#06b6d4' }} />
              ) : (
                <div className="w-36 h-36 rounded-xl flex items-center justify-center text-6xl" style={{ backgroundColor: '#06b6d4', color: '#0f172a' }}>
                  {data.personalInfo.fullName ? data.personalInfo.fullName.charAt(0) : 'üë§'}
                </div>
              )}
            </div>
            
            {/* Name and Social Links */}
            <div className="flex-1">
              <h1 className="text-5xl font-black mb-2" style={{ color: '#06b6d4' }}>{data.personalInfo.fullName || 'YOUR NAME'}</h1>
              <div className="h-1 w-24 mb-3" style={{ backgroundColor: '#06b6d4' }}></div>
              <p className="text-2xl mb-4">{data.personalInfo.jobTitle || 'Your Job Title'}</p>
              
              {/* Social Links with icons */}
              <div className="flex gap-4 text-sm">
                {data.personalInfo.linkedin && (
                  <span className="px-3 py-1 rounded" style={{ backgroundColor: '#06b6d4', color: '#0f172a' }}>üîó LinkedIn</span>
                )}
                {data.personalInfo.github && (
                  <span className="px-3 py-1 rounded" style={{ backgroundColor: '#8b5cf6', color: 'white' }}>üíª GitHub</span>
                )}
                {data.personalInfo.website && (
                  <span className="px-3 py-1 rounded" style={{ backgroundColor: '#10b981', color: 'white' }}>üåê Portfolio</span>
                )}
              </div>
            </div>
          </div>
          
          {/* Two-column body */}
          <div className="flex">
            {/* Left Column - 60% */}
            <div className="w-3/5 p-8">
              {/* Summary */}
              {data.summary && (
                <div className="mb-6">
                  <div className="flex items-center gap-2 mb-3">
                    <div className="w-1 h-6" style={{ backgroundColor: '#06b6d4' }}></div>
                    <h2 className="text-xl font-bold" style={{ color: '#06b6d4' }}>PROFILE</h2>
                  </div>
                  <p className="text-sm leading-relaxed">{data.summary}</p>
                </div>
              )}
              
              {/* Experience */}
              {data.experience.length > 0 && (
                <div className="mb-6">
                  <div className="flex items-center gap-2 mb-3">
                    <div className="w-1 h-6" style={{ backgroundColor: '#06b6d4' }}></div>
                    <h2 className="text-xl font-bold" style={{ color: '#06b6d4' }}>EXPERIENCE</h2>
                  </div>
                  {data.experience.map((exp, idx) => (
                    <div key={idx} className="mb-4 pl-3 border-l-2" style={{ borderColor: '#334155' }}>
                      <div className="flex justify-between items-start mb-1">
                        <div>
                          <h3 className="font-bold text-sm" style={{ color: '#06b6d4' }}>{exp.jobTitle}</h3>
                          <p className="text-sm">{exp.company}</p>
                        </div>
                        <span className="text-xs px-2 py-1 rounded" style={{ backgroundColor: '#1e293b' }}>{exp.startDate} - {exp.endDate}</span>
                      </div>
                      <p className="text-xs mt-1 whitespace-pre-line opacity-90">{exp.description}</p>
                    </div>
                  ))}
                </div>
              )}
              
              {/* Projects */}
              {data.projects.length > 0 && (
                <div>
                  <div className="flex items-center gap-2 mb-3">
                    <div className="w-1 h-6" style={{ backgroundColor: '#8b5cf6' }}></div>
                    <h2 className="text-xl font-bold" style={{ color: '#8b5cf6' }}>PROJECTS</h2>
                  </div>
                  {data.projects.map((proj, idx) => (
                    <div key={idx} className="mb-3 pl-3 border-l-2" style={{ borderColor: '#334155' }}>
                      <h3 className="font-bold text-sm" style={{ color: '#8b5cf6' }}>{proj.title}</h3>
                      <p className="text-xs mt-1">{proj.description}</p>
                      {proj.technologies && (
                        <p className="text-xs mt-1 opacity-70">Tech: {proj.technologies}</p>
                      )}
                    </div>
                  ))}
                </div>
              )}
            </div>
            
            {/* Right Column - 40% */}
            <div className="w-2/5 p-8" style={{ backgroundColor: '#1e293b' }}>
              {/* Contact */}
              <div className="mb-6">
                <h3 className="font-bold mb-3 text-sm" style={{ color: '#06b6d4' }}>CONTACT</h3>
                <div className="text-xs space-y-2">
                  {data.personalInfo.email && <p className="break-words">üìß {data.personalInfo.email}</p>}
                  {data.personalInfo.phone && <p>üì± {data.personalInfo.phone}</p>}
                  {data.personalInfo.location && <p>üìç {data.personalInfo.location}</p>}
                </div>
              </div>
              
              {/* Skills as tag cloud */}
              {data.skills.length > 0 && (
                <div className="mb-6">
                  <h3 className="font-bold mb-3 text-sm" style={{ color: '#06b6d4' }}>SKILLS</h3>
                  <div className="flex flex-wrap gap-2">
                    {data.skills.map((skill, idx) => {
                      const colors = ['#06b6d4', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444'];
                      const color = colors[idx % colors.length];
                      return (
                        <span key={idx} className="text-xs px-2 py-1 rounded font-medium" style={{ backgroundColor: color + '30', color: color, border: `1px solid ${color}` }}>
                          {skill}
                        </span>
                      );
                    })}
                  </div>
                </div>
              )}
              
              {/* Education */}
              {data.education.length > 0 && (
                <div className="mb-6">
                  <h3 className="font-bold mb-3 text-sm" style={{ color: '#06b6d4' }}>EDUCATION</h3>
                  {data.education.map((edu, idx) => (
                    <div key={idx} className="mb-3">
                      <h4 className="font-bold text-xs">{edu.degree}</h4>
                      <p className="text-xs">{edu.institution}</p>
                      <p className="text-xs opacity-70">{edu.year}</p>
                    </div>
                  ))}
                </div>
              )}
              
              {/* Certifications */}
              {data.certifications.length > 0 && (
                <div>
                  <h3 className="font-bold mb-3 text-sm" style={{ color: '#06b6d4' }}>CERTIFICATIONS</h3>
                  <div className="text-xs space-y-2">
                    {data.certifications.map((cert, idx) => (
                      <div key={idx} className="flex items-start gap-2">
                        <span style={{ color: '#10b981' }}>‚úì</span>
                        <span>{cert}</span>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    };
    
    // Elegant Serif Template
    const ElegantSerifTemplate = ({ data, fontClass }) => {
      return (
        <div id="resume-preview" className={`a4-preview p-12 font-playfair`} style={{ color: data.themeColors.text }}>
          <div className="text-center mb-10">
            <h1 className="text-5xl font-bold mb-2" style={{ color: data.themeColors.accent }}>
              {data.personalInfo.fullName || 'Your Name'}
            </h1>
            <div className="w-32 h-0.5 mx-auto mb-3" style={{ backgroundColor: data.themeColors.accent }}></div>
            <p className="text-xl italic mb-4">{data.personalInfo.jobTitle || 'Your Job Title'}</p>
            <div className="text-sm space-x-2">
              {data.personalInfo.email && <span>{data.personalInfo.email}</span>}
              {data.personalInfo.phone && <span>‚Ä¢</span>}
              {data.personalInfo.phone && <span>{data.personalInfo.phone}</span>}
            </div>
          </div>
          
          {data.summary && (
            <div className="mb-8 text-center">
              <p className="text-sm leading-relaxed italic max-w-3xl mx-auto">{data.summary}</p>
            </div>
          )}
          
          {data.experience.length > 0 && (
            <div className="mb-8">
              <h2 className="text-2xl font-bold mb-4 text-center" style={{ color: data.themeColors.accent }}>
                Professional Experience
              </h2>
              {data.experience.map((exp, idx) => (
                <div key={idx} className="mb-5">
                  <div className="text-center mb-2">
                    <h3 className="font-bold text-lg">{exp.jobTitle}</h3>
                    <p className="text-sm italic">{exp.company} | {exp.startDate} - {exp.endDate}</p>
                  </div>
                  <p className="text-sm leading-relaxed whitespace-pre-line">{exp.description}</p>
                </div>
              ))}
            </div>
          )}
          
          {data.education.length > 0 && (
            <div className="mb-8">
              <h2 className="text-2xl font-bold mb-4 text-center" style={{ color: data.themeColors.accent }}>
                Education
              </h2>
              {data.education.map((edu, idx) => (
                <div key={idx} className="text-center mb-3">
                  <h3 className="font-bold">{edu.degree}</h3>
                  <p className="text-sm italic">{edu.institution} | {edu.year}</p>
                </div>
              ))}
            </div>
          )}
          
          {data.skills.length > 0 && (
            <div className="mb-8">
              <h2 className="text-2xl font-bold mb-4 text-center" style={{ color: data.themeColors.accent }}>
                Skills &amp; Expertise
              </h2>
              <p className="text-sm text-center">{data.skills.join(' ‚Ä¢ ')}</p>
            </div>
          )}
          
          {/* Custom Fields */}
          {data.customFields && data.customFields.length > 0 && data.customFields.map((field, idx) => (
            <div key={field.id || idx} className="mb-8">
              <h2 className="text-2xl font-bold mb-4 text-center" style={{ color: data.themeColors.accent }}>
                {field.title}
              </h2>
              <p className="text-sm text-center leading-relaxed whitespace-pre-line">{field.content}</p>
            </div>
          ))}
        </div>
      );
    };
    
    // Main App Component
    const App = () => {
      const [currentScreen, setCurrentScreen] = useState('landing');
      const [resumeData, setResumeData] = useState(defaultState);
      const [toast, setToast] = useState(null);
      const [showLoadModal, setShowLoadModal] = useState(false);
      const [savedResume, setSavedResume] = useState(null);
      
      // Note: Auto-save to localStorage not available in sandboxed environment
      // Data persists during current session only
      
      const showToast = (message, type = 'success') => {
        setToast({ message, type });
      };
      
      const handleStartBuilding = () => {
        setCurrentScreen('templates');
      };
      
      const handleViewTemplates = () => {
        document.getElementById('templates')?.scrollIntoView({ behavior: 'smooth' });
      };
      
      const handleSelectTemplate = (templateName) => {
        setResumeData(prev => ({ ...prev, template: templateName }));
        setCurrentScreen('inputChoice');
      };
      
      const handleManualInput = (useSampleData = false) => {
        if (useSampleData) {
          setResumeData(prev => ({
            ...prev,
            ...sampleData,
            template: prev.template,
            themeColors: prev.themeColors,
            font: prev.font
          }));
          showToast('‚ú® Sample data loaded! Feel free to edit and customize.', 'success');
        }
        setCurrentScreen('builder');
      };
      
      const handleUpload = async (file) => {
        if (!file) return;
        
        try {
          showToast('üîç Analyzing your resume...', 'info');
          console.log('Starting file upload:', file.name);
          
          let extractedText = '';
          
          // Determine file type and extract text accordingly
          if (file.type === 'application/pdf') {
            console.log('Extracting from PDF...');
            extractedText = await extractTextFromPDF(file);
          } else if (file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' || file.name.endsWith('.docx')) {
            console.log('Extracting from DOCX...');
            extractedText = await extractTextFromDOCX(file);
          } else if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
            console.log('Extracting from TXT...');
            // Handle plain text files
            extractedText = await new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onload = (e) => resolve(e.target.result);
              reader.onerror = reject;
              reader.readAsText(file);
            });
          } else {
            showToast('Unsupported file type. Please upload PDF, DOCX, or TXT.', 'error');
            return;
          }
          
          console.log('Extracted text length:', extractedText.length);
          
          // Parse the extracted text into structured resume data
          const parsedData = parseResumeText(extractedText);
          
          // CRITICAL: Create complete updated state with ALL extracted fields including custom sections
          const updatedState = {
            personalInfo: {
              fullName: parsedData.personalInfo.fullName || '',
              jobTitle: parsedData.personalInfo.jobTitle || '',
              email: parsedData.personalInfo.email || '',
              phone: parsedData.personalInfo.phone || '',
              location: parsedData.personalInfo.location || '',
              linkedin: parsedData.personalInfo.linkedin || '',
              website: parsedData.personalInfo.website || '',
              github: parsedData.personalInfo.github || '',
              twitter: parsedData.personalInfo.twitter || '',
              photoUrl: '' // Keep empty unless photo is extracted
            },
            summary: parsedData.summary || '',
            experience: parsedData.experience || [],
            education: parsedData.education || [],
            projects: parsedData.projects || [],
            skills: parsedData.skills || [],
            certifications: parsedData.certifications || [],
            achievements: parsedData.achievements || [],
            languages: parsedData.languages || [],
            interests: parsedData.interests || [],
            references: parsedData.references || [],
            awards: parsedData.awards || [],
            publications: parsedData.publications || [],
            volunteering: parsedData.volunteering || [],
            customFields: parsedData.customFields || [],
            // Preserve existing template, theme, and font settings
            template: resumeData.template,
            themeColors: resumeData.themeColors,
            font: resumeData.font
          };
          
          console.log('State before update:', resumeData);
          console.log('Updated state:', updatedState);
          
          // Update state completely
          setResumeData(updatedState);
          
          // Create comprehensive summary of what was extracted
          const summary = [];
          if (parsedData.personalInfo.fullName) summary.push('name');
          if (parsedData.personalInfo.email) summary.push('email');
          if (parsedData.personalInfo.phone) summary.push('phone');
          if (parsedData.experience.length > 0) summary.push(`${parsedData.experience.length} job${parsedData.experience.length > 1 ? 's' : ''}`);
          if (parsedData.education.length > 0) summary.push(`${parsedData.education.length} degree${parsedData.education.length > 1 ? 's' : ''}`);
          if (parsedData.skills.length > 0) summary.push(`${parsedData.skills.length} skills`);
          if (parsedData.projects.length > 0) summary.push(`${parsedData.projects.length} project${parsedData.projects.length > 1 ? 's' : ''}`);
          if (parsedData.certifications.length > 0) summary.push(`${parsedData.certifications.length} cert${parsedData.certifications.length > 1 ? 's' : ''}`);
          if (parsedData.customFields && parsedData.customFields.length > 0) {
            summary.push(`${parsedData.customFields.length} custom section${parsedData.customFields.length > 1 ? 's' : ''}`);
          }
          
          const summaryText = summary.length > 0 ? 
            `‚úÖ Extracted: ${summary.join(', ')}` : 
            '‚ö†Ô∏è Parsing complete, but some fields may need manual entry';
          
          // Log custom sections found
          if (parsedData.customFields && parsedData.customFields.length > 0) {
            console.log('\nüéØ AUTO-CREATED CUSTOM SECTIONS:');
            parsedData.customFields.forEach(field => {
              console.log(`  ‚Ä¢ ${field.title}`);
            });
          }
          
          // Show detailed success message
          showToast(summaryText, 'success');
          
          // Show info about custom sections if any were detected
          if (parsedData.customFields && parsedData.customFields.length > 0) {
            setTimeout(() => {
              const customTitles = parsedData.customFields.map(f => f.title).join(', ');
              showToast(`‚ú® Auto-created custom sections: ${customTitles}`, 'info');
            }, 2000);
          }
          
          // Show warnings for missing critical fields
          setTimeout(() => {
            const warnings = [];
            if (!parsedData.personalInfo.fullName) warnings.push('name');
            if (!parsedData.personalInfo.email) warnings.push('email');
            if (parsedData.experience.length === 0) warnings.push('work experience');
            
            if (warnings.length > 0) {
              showToast(`üìù Please add: ${warnings.join(', ')}`, 'info');
            }
          }, parsedData.customFields && parsedData.customFields.length > 0 ? 4000 : 2000);
          
          // Navigate to builder screen
          setTimeout(() => {
            setCurrentScreen('builder');
          }, 3000);
          
        } catch (error) {
          console.error('Error parsing resume:', error);
          showToast('‚ùå Failed to parse resume. Please try manual entry or a different file format.', 'error');
        }
      };
      
      const handleExport = async () => {
        try {
          // Optional validation if present
          if (typeof validateForm === 'function') {
            try {
              if (!validateForm()) {
                showToast('‚ö†Ô∏è Please fix validation errors before exporting', 'error');
                setActiveSection && setActiveSection('personal');
                return;
              }
            } catch {}
          }
          
          let element = document.getElementById('resume-preview');
          if (!element) {
            if (!showPreview) setShowPreview(true);
            await new Promise(r => requestAnimationFrame(() => requestAnimationFrame(r)));
            element = document.getElementById('resume-preview');
            if (!element) {
              showToast('Preview not found. Please show preview first.', 'error');
              return;
            }
          }
          
          showToast('Generating high-quality PDF...', 'info');

          const imgs = Array.from(element.querySelectorAll('img'));
          if (document.fonts && document.fonts.ready) {
            try { await document.fonts.ready; } catch {}
          }
          try { element.scrollIntoView({ behavior: 'instant', block: 'center' }); } catch {}
          await Promise.all(imgs.map(img => img.complete ? Promise.resolve() : new Promise(res => { img.onload = img.onerror = res; })));
          for (const img of imgs) {
            const src = img.getAttribute('src');
            if (!src) continue;
            const isHttp = /^https?:\/\//i.test(src);
            const sameOrigin = isHttp ? (new URL(src, window.location.href)).origin === window.location.origin : true;
            if (isHttp && !sameOrigin) {
              try {
                const resp = await fetch(src, { mode: 'cors', credentials: 'omit' });
                const blob = await resp.blob();
                const dataUrl = await new Promise(r => {
                  const reader = new FileReader();
                  reader.onload = () => r(reader.result);
                  reader.readAsDataURL(blob);
                });
                img.setAttribute('crossorigin', 'anonymous');
                img.src = dataUrl;
              } catch (e) {
                console.warn('Failed to inline image, skipping for export:', src, e);
                img.style.visibility = 'hidden';
              }
            }
          }

          // Wait a bit for preview to render
          await new Promise(resolve => setTimeout(resolve, 500));

          const canvas = await html2canvas(element, {
            scale: 3, // Higher resolution for better quality
            useCORS: true,
            allowTaint: true,
            logging: false,
            backgroundColor: '#ffffff',
            windowWidth: element.scrollWidth,
            windowHeight: element.scrollHeight
          });
          
          const imgData = canvas.toDataURL('image/png', 1.0);
          const { jsPDF } = window.jspdf;
          const pdf = new jsPDF('p', 'mm', 'a4');
          
          const imgWidth = 210; // A4 width in mm
          const imgHeight = (canvas.height * imgWidth) / canvas.width;
          
          // Handle multi-page if content is too long
          if (imgHeight > 297) {
            // Content spans multiple pages
            let position = 0;
            const pageHeight = 297;
            
            while (position < imgHeight) {
              pdf.addImage(imgData, 'PNG', 0, -position, imgWidth, imgHeight);
              position += pageHeight;
              
              if (position < imgHeight) {
                pdf.addPage();
              }
            }
          } else {
            pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
          }
          
          const fileName = `Resume_${(resumeData.personalInfo.fullName || 'Download').replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
          pdf.save(fileName);
          
          showToast('‚úÖ PDF downloaded successfully! Check your downloads folder.', 'success');
        } catch (error) {
          try {
            const fileName = `Resume_${(resumeData.personalInfo.fullName || 'Download').replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
            const opt = {
              margin: [5, 5, 5, 5],
              filename: fileName,
              image: { type: 'jpeg', quality: 0.98 },
              html2canvas: { scale: 2, useCORS: true, allowTaint: true },
              jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            const el = document.getElementById('resume-preview');
            if (!el) throw new Error('Preview element not found');
            await html2pdf().set(opt).from(el).save();
            showToast('‚úÖ PDF downloaded successfully! Check your downloads folder.', 'success');
          } catch (fallbackErr) {
            showToast('‚ùå Export failed. Make sure preview is visible and try again.', 'error');
            console.error('Export error:', error, error && error.message, error && error.stack);
            console.error('Export fallback error:', fallbackErr, fallbackErr && fallbackErr.message, fallbackErr && fallbackErr.stack);
          }
        }
      };
      
      React.useEffect(() => {
        window.exportResume = handleExport;
        const onKey = (e) => {
          const key = e.key && e.key.toLowerCase();
          if (e.ctrlKey && e.shiftKey && key === 'e') {
            e.preventDefault();
            handleExport();
          }
        };
        window.addEventListener('keydown', onKey);
        return () => {
          window.removeEventListener('keydown', onKey);
          if (window.exportResume === handleExport) delete window.exportResume;
        };
      }, [handleExport]);

      const handleBack = () => {
        if (currentScreen === 'builder') {
          setCurrentScreen('inputChoice');
        } else if (currentScreen === 'inputChoice') {
          setCurrentScreen('templates');
        } else if (currentScreen === 'templates') {
          setCurrentScreen('landing');
        }
      };
      
      return (
        <div>
          {currentScreen === 'landing' && (
            <LandingPage
              onStartBuilding={handleStartBuilding}
              onViewTemplates={handleViewTemplates}
            />
          )}
          
          {currentScreen === 'templates' && (
            <TemplateGallery
              onSelectTemplate={handleSelectTemplate}
              onBack={handleBack}
            />
          )}
          
          {currentScreen === 'inputChoice' && (
            <DataInputChoice
              onManualInput={handleManualInput}
              onUpload={handleUpload}
              onBack={handleBack}
            />
          )}
          
          {currentScreen === 'builder' && (
            <Builder
              resumeData={resumeData}
              setResumeData={setResumeData}
              onBack={handleBack}
              onExport={handleExport}
            />
          )}
          
          {toast && (
            <Toast
              message={toast.message}
              type={toast.type}
              onClose={() => setToast(null)}
            />
          )}

          <button
            onClick={handleExport}
            title="Quick Export (Ctrl+Shift+E)"
            className="fixed bottom-6 right-6 z-50 rounded-full shadow-lg bg-red-600 hover:bg-red-700 text-white w-14 h-14 flex items-center justify-center text-2xl"
            aria-label="Quick Export PDF"
          >
            üìÑ
          </button>
          
          {/* Load Saved Resume Modal */}
          {showLoadModal && savedResume && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 animate-fade-in">
                <h2 className="text-2xl font-bold mb-4">Continue where you left off?</h2>
                <div className="mb-6">
                  <p className="text-gray-600 mb-2">
                    <strong>Resume for:</strong> {savedResume.personalInfo?.fullName || 'Untitled Resume'}
                  </p>
                  <p className="text-sm text-gray-500">
                    <strong>Template:</strong> {savedResume.template}
                  </p>
                  <p className="text-sm text-gray-500">
                    <strong>Last modified:</strong> {savedResume.lastModified ? new Date(savedResume.lastModified).toLocaleString() : 'Unknown'}
                  </p>
                </div>
                <div className="flex gap-3">
                  <button
                    onClick={() => {
                      const completeData = {
                        ...savedResume,
                        experience: savedResume.experience || [],
                        education: savedResume.education || [],
                        projects: savedResume.projects || [],
                        skills: savedResume.skills || [],
                        certifications: savedResume.certifications || [],
                        achievements: savedResume.achievements || [],
                        languages: savedResume.languages || [],
                        interests: savedResume.interests || [],
                        references: savedResume.references || []
                      };
                      setResumeData(completeData);
                      setCurrentScreen('builder');
                      setShowLoadModal(false);
                      showToast('‚úÖ Resume loaded successfully!', 'success');
                    }}
                    className="flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition"
                  >
                    üìù Continue Editing
                  </button>
                  <button
                    onClick={() => {
                      setShowLoadModal(false);
                      showToast('Starting with a fresh resume', 'info');
                    }}
                    className="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition"
                  >
                    ‚ú® Start Fresh
                  </button>
                </div>
                <button
                  onClick={() => {
                    setShowLoadModal(false);
                  }}
                  className="w-full mt-3 text-sm text-red-600 hover:text-red-700"
                >
                  Delete saved resume
                </button>
              </div>
            </div>
          )}
        </div>
      );
    };
    
    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>